<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Surveillance for a count data time series using the EARS C1, C2 or C3 method and its extensions — earsC • surveillance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Surveillance for a count data time series using the EARS C1, C2 or C3 method and its extensions — earsC"><meta name="description" content="
  The function takes range values of the surveillance time
  series sts and for each time point computes a threshold for the number of counts
   based on values from the recent past.
  This is then compared to the observed
  number of counts. If the observation is above a specific quantile of
  the prediction interval, then an alarm is raised.  This method is especially useful
  for data without many historic values, since it only needs counts from the recent past.
"><meta property="og:description" content="
  The function takes range values of the surveillance time
  series sts and for each time point computes a threshold for the number of counts
   based on values from the recent past.
  This is then compared to the observed
  number of counts. If the observation is above a specific quantile of
  the prediction interval, then an alarm is raised.  This method is especially useful
  for data without many historic values, since it only needs counts from the recent past.
"><!-- For Rd equations in pkgdown 2.1.0, see https://katex.org/docs/autorender.html --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
          throwOnError: false,
          macros: {"\\code": "\\texttt"}
      })
  });
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveillance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.24.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/events.html">Events</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a></li>
      </ul><ul class="navbar-nav"></ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Surveillance for a count data time series using the EARS C1, C2 or C3 method and its extensions</h1>

      <div class="d-none name"><code>earsC.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><!-- % -->
  The function takes <code>range</code> values of the surveillance time
  series <code>sts</code> and for each time point computes a threshold for the number of counts
   based on values from the recent past.
  This is then compared to the observed
  number of counts. If the observation is above a specific quantile of
  the prediction interval, then an alarm is raised.  This method is especially useful
  for data without many historic values, since it only needs counts from the recent past.
<!-- % --></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">earsC</span><span class="op">(</span><span class="va">sts</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>range <span class="op">=</span> <span class="cn">NULL</span>, method <span class="op">=</span> <span class="st">"C1"</span>,</span>
<span>                          baseline <span class="op">=</span> <span class="fl">7</span>, minSigma <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                          alpha <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sts">sts<a class="anchor" aria-label="anchor" href="#arg-sts"></a></dt>
<dd><p>object of class sts (including the <code>observed</code> and the <code>state</code> time series) , which is to be monitored.</p></dd>

<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Control object</p><dl><dt><code>range</code></dt>
<dd><p>Specifies the index in the <code>sts</code> object of
	all the timepoints which
        should be monitored. If <code>range</code> is <code>NULL</code> the maximum number
        of possible timepoints is used (this number depends on the method chosen):</p><dl><dt>C1</dt>
<dd><p>all timepoints from the observation with index <code>baseline + 1</code>
	    can be monitored,</p></dd>

	  <dt>C2</dt>
<dd><p>timepoints from index <code>baseline + 3</code> can be
	    monitored,</p></dd>

	  <dt>C3</dt>
<dd><p>timepoints starting from the index <code>baseline + 5</code> can be monitored.</p></dd>

	
</dl><p></p></dd>

      <dt><code>method</code></dt>
<dd><p>String indicating which method to use: <br></p><dl><dt><code>"C1"</code></dt>
<dd><p>for EARS C1-MILD method (Default),</p></dd>

	  <dt><code>"C2"</code></dt>
<dd><p>for EARS C2-MEDIUM method,</p></dd>

	  <dt><code>"C3"</code></dt>
<dd><p>for EARS C3-HIGH method.</p></dd>

	
</dl><p>See Details for further information about the methods.</p></dd>

<dt><code>baseline</code></dt>
<dd><p>how many time points to use for calculating the baseline, see details</p></dd>

<dt><code>minSigma</code></dt>
<dd><p>By default 0. If <code>minSigma</code> is higher than 0, for C1 and
C2, the quantity zAlpha * minSigma is then the alerting threshold if the
baseline is zero. Howard Burkom suggests using a value of 0.5 or 1 for sparse data.</p></dd>

    <dt><code>alpha</code></dt>
<dd><p>An approximate (two-sided) \((1-\alpha)\cdot 100\%\) prediction
     interval is calculated. By default if <code>alpha</code> is <code>NULL</code>
  the value 0.001 is assumed
     for C1 and C2 whereas 0.025 is assumed for C3. These different choices are the one made at the CDC.</p></dd>

        %

</dl><p></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The three methods are different in terms of baseline used for calculation of
  the expected value and in terms of method for calculating the expected value:</p><ul><li><p>in C1 and C2 the expected value is the moving average of counts over
 the sliding window of the baseline and the prediction interval depends on the
 standard derivation of the observed counts in this window. They can be considered as
 Shewhart control charts with a small sample used for calculations.</p></li>
<li><p>in C3 the expected value is based on the sum over 3 timepoints
 (assessed timepoints and the two previous timepoints) of the discrepancy
 between observations and predictions, predictions being calculated with
  the C2 method.
This method has similarities with a CUSUM method due to it
adding discrepancies between predictions and observations over several timepoints,
but is not a CUSUM  (sum over 3 timepoints, not accumulation over a whole range),
 even if it sometimes is presented as such.</p></li>
</ul><p>Here is what the function does for each method, see the literature
  sources for further details:</p><ol><li><p>For C1 the baseline are the <code>baseline</code> (default 7) timepoints before the assessed timepoint t,
 t-<code>baseline</code> to t-1. The expected value is the mean of the baseline. An approximate
  (two-sided) \((1-\alpha)\cdot 100\%\) prediction interval is calculated based on the
   assumption that  the difference between the expected value and the observed
   value divided by the standard derivation of counts over the sliding window,
    called \(C_1(t)\), follows a standard normal distribution in the absence
    of outbreaks:
$$C_1(t)= \frac{Y(t)-\bar{Y}_1(t)}{S_1(t)},$$
where
$$\bar{Y}_1(t)= \frac{1}{\code{baseline}} \sum_{i=t-1}^{t-\code{baseline}} Y(i)$$
and
$$ S^2_1(t)= \frac{1}{6} \sum_{i=t-1}^{t-\code{baseline}} [Y(i) - \bar{Y}_1(i)]^2.$$
Then under the null hypothesis of no outbreak,
 $$C_1(t) \mathcal \&gt; \sim \&gt; {N}(0,1)$$
An alarm is raised if $$C_1(t)\ge z_{1-\alpha}$$
with \(z_{1-\alpha}\) the \((1-\alpha)^{th}\) quantile of the standard normal distribution. <br></p>
<p>The upperbound \(U_1(t)\) is then defined by:
 $$U_1(t)= \bar{Y}_1(t) + z_{1-\alpha}S_1(t).$$</p></li>
<li><p>C2 is very similar to C1 apart from a 2-day lag in the baseline definition.
In other words the baseline for C2 is <code>baseline</code> (Default: 7) timepoints with a 2-day lag before the monitored
timepoint t, i.e. \((t-\code{baseline}-2)\) to \(t-3\). The expected value is the mean of the baseline. An approximate
  (two-sided) \((1-\alpha)\cdot 100\%\) prediction interval is calculated based on the
   assumption that  the difference between the expected value and the observed
   value divided by the standard derivation of counts over the sliding window,
    called \(C_2(t)\), follows a standard normal distribution in the absence
    of outbreaks:
$$C_2(t)= \frac{Y(t)-\bar{Y}_2(t)}{S_2(t)},$$
where
$$\bar{Y}_2(t)= \frac{1}{\code{baseline}} \sum_{i=t-3}^{t-\code{baseline}-2} Y(i)$$
and
$$ S^2_2(t)= \frac{1}{\code{baseline}-1} \sum_{i=t-3}^{t-\code{baseline}-2} [Y(i) - \bar{Y}_2(i)]^2.$$
Then under the null hypothesis of no outbreak,
 $$C_2(t) \mathcal \sim {N}(0,1)$$
An alarm is raised if $$C_2(t)\ge z_{1-\alpha},$$
with \(z_{1-\alpha}\) the \((1-\alpha)^{th}\) quantile of the standard normal distribution. <br></p>
<p>The upperbound \(U_{2}(t)\) is then defined by:</p>
<p>$$U_{2}(t)= \bar{Y}_{2}(t) + z_{1-\alpha}S_{2}(t).$$</p></li>
<li><p>C3 is quite different from the two other methods, but it is based on C2.
 Indeed it uses \(C_2(t)\) from timepoint t and the two previous timepoints.
 This means the baseline consists of the timepoints \(t-(\code{baseline}+4)\) to \(t-3\).
 The statistic \(C_3(t)\) is the sum of discrepancies between observations and
 predictions.
$$C_3(t)= \sum_{i=t}^{t-2} \max(0,C_2(i)-1)$$
 Then under the null hypothesis of no outbreak,
 $$C_3(t) \mathcal \sim {N}(0,1)$$
An alarm is raised if $$C_3(t)\ge z_{1-\alpha},$$
with \(z_{1-\alpha}\) the \((1-\alpha)^{th}\) quantile of the standard normal distribution. <br></p>
<p>The upperbound \(U_3(t)\) is then defined by:
 $$U_3(t)= \bar{Y}_2(t) + S_2(t)\left(z_{1-\alpha}-\sum_{i=t-1}^{t-2} \max(0,C_2(i)-1)\right).$$</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>sts</code> with the slots <code>upperbound</code> and <code>alarm</code> filled
 by the chosen method.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>M. Salmon, H. Burkom</p>
    </div>
    <div class="section level2">
    <h2 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h2>
    <p>Fricker, R.D., Hegler, B.L, and Dunfee, D.A. (2008). Comparing syndromic surveillance detection methods: EARS versus a CUSUM-based methodology,
  27:3407-3429, Statistics in medicine.</p>
<p>Salmon, M., Schumacher, D. and Höhle, M. (2016):
  Monitoring count time series in <span style="R">R</span>: Aberration detection in public
  health surveillance. <em>Journal of Statistical Software</em>,
  <b>70</b> (10), 1-35. <a href="https://doi.org/10.18637/jss.v070.i10" class="external-link">doi:10.18637/jss.v070.i10</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span></span>
<span><span class="co">#Sim data and convert to sts object</span></span>
<span><span class="va">disProgObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim.pointSource.html">sim.pointSource</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.99</span>, r <span class="op">=</span> <span class="fl">0.5</span>, length <span class="op">=</span> <span class="fl">208</span>, A <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                              alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0</span>, phi <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                              frequency <span class="op">=</span> <span class="fl">1</span>, state <span class="op">=</span> <span class="cn">NULL</span>, K <span class="op">=</span> <span class="fl">1.7</span><span class="op">)</span></span>
<span><span class="va">stsObj</span> <span class="op">&lt;-</span> <span class="fu"><a href="disProg2sts.html">disProg2sts</a></span><span class="op">(</span> <span class="va">disProgObj</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Call earsC function and show result</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">earsC</span><span class="op">(</span><span class="va">stsObj</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fl">20</span><span class="op">:</span><span class="fl">208</span>, method<span class="op">=</span><span class="st">"C1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res1</span>, legend.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>horiz<span class="op">=</span><span class="cn">TRUE</span>, x<span class="op">=</span><span class="st">"topright"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Compare C3 upperbounds depending on alpha</span></span>
<span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu">earsC</span><span class="op">(</span><span class="va">stsObj</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fl">20</span><span class="op">:</span><span class="fl">208</span>,method<span class="op">=</span><span class="st">"C3"</span>,alpha <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="stsSlots.html">upperbound</a></span><span class="op">(</span><span class="va">res3</span><span class="op">)</span>, type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span>
<span><span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu">earsC</span><span class="op">(</span><span class="va">stsObj</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fl">20</span><span class="op">:</span><span class="fl">208</span>,method<span class="op">=</span><span class="st">"C3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="stsSlots.html">upperbound</a></span><span class="op">(</span><span class="va">res3</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by <a href="https://www.imbe.med.fau.de/person/sebastian-meyer" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000. Hosted on <a href="https://R-forge.R-project.org/projects/surveillance/" class="external-link"><img src="https://r-forge.r-project.org/themes/rforge/imagesrf/logo.png" height="18" alt="R-Forge"></a></p>
</div>

    </footer></div>



  </body></html>

