<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulation of Epidemic Data — twinSIR_simulation • surveillance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation of Epidemic Data — twinSIR_simulation"><meta name="description" content='This function simulates the infection (and removal) times of
  an epidemic.  Besides the classical SIR type of epidemic, also SI, SIRS and
  SIS epidemics are supported.  Simulation works via the conditional intensity
  of infection of an individual, given some (time varying) endemic covariates
  and/or some distance functions (epidemic components) as well as the fixed
  positions of the individuals.  The lengths of the infectious and removed
  periods are generated following a pre-specified function (can be
  deterministic).
The simulate method for objects of class
  "twinSIR" simulates new epidemic data using the model and
  the parameter estimates of the fitted object.'><meta property="og:description" content='This function simulates the infection (and removal) times of
  an epidemic.  Besides the classical SIR type of epidemic, also SI, SIRS and
  SIS epidemics are supported.  Simulation works via the conditional intensity
  of infection of an individual, given some (time varying) endemic covariates
  and/or some distance functions (epidemic components) as well as the fixed
  positions of the individuals.  The lengths of the infectious and removed
  periods are generated following a pre-specified function (can be
  deterministic).
The simulate method for objects of class
  "twinSIR" simulates new epidemic data using the model and
  the parameter estimates of the fitted object.'><!-- For Rd equations in pkgdown 2.1.0, see https://katex.org/docs/autorender.html --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
          throwOnError: false,
          macros: {"\\code": "\\texttt"}
      })
  });
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveillance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.24.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/events.html">Events</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a></li>
      </ul><ul class="navbar-nav"></ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation of Epidemic Data</h1>

      <div class="d-none name"><code>twinSIR_simulation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function simulates the infection (and removal) times of
  an epidemic.  Besides the classical SIR type of epidemic, also SI, SIRS and
  SIS epidemics are supported.  Simulation works via the conditional intensity
  of infection of an individual, given some (time varying) endemic covariates
  and/or some distance functions (epidemic components) as well as the fixed
  positions of the individuals.  The lengths of the infectious and removed
  periods are generated following a pre-specified function (can be
  deterministic).</p>
<p>The <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></code> method for objects of class
  <code>"<a href="twinSIR.html">twinSIR</a>"</code> simulates new epidemic data using the model and
  the parameter estimates of the fitted object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simEpidata</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">id.col</span>, <span class="va">I0.col</span>, <span class="va">coords.cols</span>, <span class="va">subset</span>,</span>
<span>           <span class="va">beta</span>, <span class="va">h0</span>, f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">alpha</span>, <span class="va">infPeriod</span>,</span>
<span>           remPeriod <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           end <span class="op">=</span> <span class="cn">Inf</span>, trace <span class="op">=</span> <span class="cn">FALSE</span>, .allocate <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'twinSIR'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">object</span>, nsim <span class="op">=</span> <span class="fl">1</span>, seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>         infPeriod <span class="op">=</span> <span class="cn">NULL</span>, remPeriod <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">object</span><span class="op">$</span><span class="va">intervals</span><span class="op">)</span><span class="op">)</span>, trace <span class="op">=</span> <span class="cn">FALSE</span>, .allocate <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>         data <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>an object of class <code>"<a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a>"</code> (or one that can be coerced to
    that class): a symbolic description of the intensity model to be estimated.
    The details of model specification are given under Details.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data.frame containing the variables in <code>formula</code> and the variables
    specified by <code>id.col</code>, <code>I0.col</code> and <code>coords.col</code> (see below).
    It represents the “history” of the endemic covariates to use for the
    simulation.  The form is similar to and can be an object of class
    <code>"<a href="epidata.html">epidata</a>"</code>.  The simulation period is split up into
    <em>consecutive</em> intervals of constant endemic covariables.  The
    data frame consists of a block of N (number of individuals) rows for each of
    those time intervals (all rows in a block share the same start and stop
    values... therefore the name “block”), where there is one row per
    individual in the block.  Each row describes the (fixed) state of the
    endemic covariates of the individual during the time interval given by the
    start and stop columns (specified through the lhs of <code>formula</code>).</p>
<p>For the <code>simulate</code> method of class <code>"twinSIR"</code> this should be
    the object of class <code>"<a href="epidata.html">epidata</a>"</code> used for the fit.  This is a
    part of the return value of the function <code>twinSIR</code>, if called with
    argument <code>keep.data</code> set to <code>TRUE</code>.</p></dd>

  <dt id="arg-id-col">id.col<a class="anchor" aria-label="anchor" href="#arg-id-col"></a></dt>
<dd><p>only if <code>data</code> does not inherit from <code>epidata</code>:
    single index of the <code>id</code> column in <code>data</code>.  Can be numeric
    (by column number) or character (by column name).<br>
    The <code>id</code> column identifies the individuals in the data-frame.  It will
    be converted to a factor variable and its levels serve also to identify
    individuals as argument to the <code>infPeriod</code> function.</p></dd>

  <dt id="arg-i-col">I0.col<a class="anchor" aria-label="anchor" href="#arg-i-col"></a></dt>
<dd><p>only if <code>data</code> does not inherit from <code>epidata</code>:
    single index of the <code>I0</code> column in <code>data</code>.  Can be numeric
    (by column number), character (by column name) or <code>NULL</code>.<br>
    The <code>I0</code> column indicates if an individual is initially infectious,
    i.e. it is already infectious at the beginning of the first time block.
    Setting <code>I0.col = NULL</code> is short for “there are no initially
    infectious individuals”. Otherwise, the variable must be logical or in
    0/1-coding.  As this variable is constant over time the initially
    infectious individuals are derived from the first time block only.</p></dd>

  <dt id="arg-coords-cols">coords.cols<a class="anchor" aria-label="anchor" href="#arg-coords-cols"></a></dt>
<dd><p>only if <code>data</code> does not inherit from <code>epidata</code>:
    index<em>es</em> of the <code>coords</code> column<em>s</em> in <code>data</code>.  Can be a
    numeric (by column number), a character (by column name) vector or
    <code>NULL</code>.<br>
    These columns contain the coordinates of the individuals.  It must be
    emphasized that the functions in this package currently assume <em>fixed
    positions</em> of the individuals during the whole epidemic.  Thus, an
    individual has the same coordinates in every block.  For simplicity, the
    coordinates are derived from the first time block only.  The epidemic
    covariates are calculated based on the Euclidean distance between the
    individuals, see <code>f</code>.</p></dd>

  <dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>an optional vector specifying a subset of the covariate history to be used
    in the simulation.</p></dd>

  <dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>numeric vector of length equal the number of endemic (<code>cox</code>) terms on
    the rhs of <code>formula</code>.  It contains the effects of the endemic predictor
    (excluding the log-baseline <code>h0</code>, see below) in the same order as in
    the formula.</p></dd>

  <dt id="arg-h-">h0<a class="anchor" aria-label="anchor" href="#arg-h-"></a></dt>
<dd><p><em>either</em> a single number to specify a constant baseline hazard
    (equal to <code>exp(h0)</code>) <em>or</em> a list of functions named
    <code>exact</code> and <code>upper</code>.  In the latter case, <code>h0$exact</code>
    is the true log-baseline hazard function and <code>h0$upper</code> is a
    <em>piecewise constant upper bound</em> for <code>h0$exact</code>.  The function
    <code>h0$upper</code> must inherit from <code><a href="https://rdrr.io/r/stats/stepfun.html" class="external-link">stepfun</a></code> with
    <code>right=FALSE</code>.  Theoretically, the intensity function is
    left-continuous, thus <code>right=TRUE</code> would be adequate, but in the
    implementation, when we evaluate the intensity at the
    <code><a href="https://rdrr.io/r/stats/stepfun.html" class="external-link">knots</a></code> (change points) of <code>h0$upper</code> we need its value
    for the subsequent interval.</p></dd>

  <dt id="arg-f-w">f, w<a class="anchor" aria-label="anchor" href="#arg-f-w"></a></dt>
<dd><p>see <code><a href="epidata.html">as.epidata</a></code>.</p></dd>

  <dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>a named numeric vector of coefficients for the epidemic
    covariates generated by <code>f</code> and <code>w</code>. The names are matched
    against <code>names(f)</code> and <code>names(w)</code>.
    Remember that <code>alpha &gt;= 0</code>.</p></dd>

  <dt id="arg-infperiod">infPeriod<a class="anchor" aria-label="anchor" href="#arg-infperiod"></a></dt>
<dd><p>a function generating lengths of infectious periods.  It should take one
    parameter (e.g. <code>ids</code>), which is a character vector of id's of
    individuals, and return appropriate infection periods for those
    individuals.  Therefore, the value of the function should be of length
    <code>length(ids)</code>.  For example, for independent and identically
    distributed infection periods following \(Exp(1)\),
    the generating function is <code>function(ids) rexp(length(ids), rate=1)</code>.
    For a constant infectious period of length c, it is sufficient to set
    <code>function (x) {c}</code>.<br>
    For the <code>simulate</code> method of class <code>"twinSIR"</code> only, this can
    also be <code>NULL</code> (the default), which means that the observed infectious
    periods of infected individuals are re-used when simulating a new epidemic
    and individuals with missing infectious periods (i.e. infection and
    recovery was not observed) are attributed to the mean observed
    infectious period.</p>
<p>Note that it is even possible to simulate an SI-epidemic by setting</p>
<p><code>infPeriod = function (x) {Inf}</code></p>
<p>In other words: once an individual became
    infected it spreads the disease forever, i.e. it will never be removed.</p></dd>

  <dt id="arg-remperiod">remPeriod<a class="anchor" aria-label="anchor" href="#arg-remperiod"></a></dt>
<dd><p>a function generating lengths of removal periods.  Per default, once an
    individual was removed it will stay in this state forever (<code>Inf</code>).
    Therefore, it will not become at-risk (S) again and re-infections are not
    possible.  Alternatively, always returning 0 as length of the removal
    period corresponds to a SIS epidemic.  Any other values correspond to SIRS.
    Note that <code>end</code> should be set to a finite value in these cases.</p></dd>

  <dt id="arg-end">end<a class="anchor" aria-label="anchor" href="#arg-end"></a></dt>
<dd><p>a single positive numeric value specifying the time point at which the
    simulation should be forced to end.  By default, this is <code>Inf</code>, i.e.
    the simulation continues until there is no susceptible individual left.<br>
    For the <code>simulate</code> method of class <code>"twinSIR"</code> the default is
    to have equal simulation and observation periods.</p></dd>

  <dt id="arg-trace">trace<a class="anchor" aria-label="anchor" href="#arg-trace"></a></dt>
<dd><p>logical (or integer) indicating if (or how often) the sets of susceptible
    and infected individuals as well as the rejection indicator (of the
    rejection sampling step) should be <code>cat</code>ed.  Defaults to <code>FALSE</code>.</p></dd>

  <dt id="arg--allocate">.allocate<a class="anchor" aria-label="anchor" href="#arg--allocate"></a></dt>
<dd><p>number of blocks to initially allocate for the event history (i.e.
    <code>.allocate*N</code> rows). By default (<code>NULL</code>), this number is set to
    <code>max(500, ceiling(nBlocks/100)*100)</code>, i.e. 500 but at least the
    number of blocks in <code>data</code> (rounded to the next multiple of 100).
    Each time the simulated epidemic exceeds the allocated space, the
    event history will be enlarged by <code>.allocate</code> blocks.</p></dd>

  <dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an object of class <code>"twinSIR"</code>.  This must contain the original
    <code>data</code> used for the fit (see <code>data</code>).</p></dd>

  <dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>number of epidemics to simulate.  Defaults to 1.</p></dd>

  <dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>an integer that will be used in the call to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></code> before
    simulating the epidemics.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>unused (argument of the generic).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A model is specified through the <code>formula</code>, which has the form</p>
<p><code>cbind(start, stop) ~ cox(endemicVar1) * cox(endemicVar2)</code>,</p>
<p>i.e. the right hand side has the usual form as in <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code>, but
  all variables are marked as being endemic by the special function
  <code><a href="twinSIR_cox.html">cox</a></code>.  The effects of those predictor terms are specified by
  <code>beta</code>.  The left hand side of the formula denotes the start
  and stop columns in <code>data</code>.  This can be omitted, if <code>data</code> inherits
  from class <code>"epidata"</code> in which case <code>cbind(start, stop)</code> will be
  used.  The epidemic model component is specified by the arguments
  <code>f</code> and <code>w</code> (and the associated coefficients <code>alpha</code>).</p>
<p>If the epidemic model component is empty and <code>infPeriod</code>
  always returns <code>Inf</code>, then one actually simulates from a pure Cox model.</p>
<p>The simulation algorithm used is <em>Ogata's modified thinning</em>.
  For details, see Höhle (2009), Section 4.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>"simEpidata"</code>, which is a <code>data.frame</code> with the
  columns <code>"id"</code>, <code>"start"</code>, <code>"stop"</code>, <code>"atRiskY"</code>,
  <code>"event"</code>, <code>"Revent"</code> and the coordinate columns (with the original
  names from <code>data</code>), which are all obligatory.  These columns are followed
  by all the variables appearing on the rhs of the <code>formula</code>.  Last but not
  least, the generated columns with epidemic covariates corresponding to the
  functions in the lists <code>f</code> and <code>w</code> are appended.</p>
<p>Note that objects of class <code>"simEpidata"</code> also inherit from class
  <code>"<a href="epidata.html">epidata</a>"</code>, thus all <code>"<a href="epidata.html">epidata</a>"</code> methods can be
  applied.</p>
<p>The <code>data.frame</code> is given the additional <em>attributes</em></p>
<dl><dt>"eventTimes"</dt>
<dd><p>numeric vector of infection time points (sorted chronologically).</p></dd>

  <dt>"timeRange"</dt>
<dd><p>numeric vector of length 2: <code>c(min(start), max(stop))</code>.</p></dd>

  <dt>"coords.cols"</dt>
<dd><p>numeric vector containing the column indices of the coordinate columns in
    the resulting data-frame.</p></dd>

  <dt>"f"</dt>
<dd><p>this equals the argument <code>f</code>.</p></dd>

  <dt>"w"</dt>
<dd><p>this equals the argument <code>w</code>.</p></dd>

  <dt>"config"</dt>
<dd><p>a list with elements <code>h0 = h0$exact</code>, <code>beta</code> and <code>alpha</code>.</p></dd>

  <dt>call</dt>
<dd><p>the matched call.</p></dd>

  <dt>terms</dt>
<dd><p>the <code>terms</code> object used.</p></dd>


</dl><p>If <code>nsim &gt; 1</code> epidemics are simulated by the
  <code>simulate</code>-method for fitted <code>"twinSIR"</code> models, these are
  returned in a list.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Höhle, M. (2009),
  Additive-Multiplicative Regression Models for Spatio-Temporal
  Epidemics, Biometrical Journal, 51(6):961-978.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Meyer and Michael Höhle</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>The <code><a href="epidata_plot.html">plot.epidata</a></code> and <code><a href="epidata_animate.html">animate.epidata</a></code> methods
for plotting and animating (simulated) epidemic data, respectively.
The <code><a href="twinSIR_intensityplot.html">intensityplot.simEpidata</a></code> method for plotting paths of
infection intensities.</p>
<p>Function <code><a href="twinSIR.html">twinSIR</a></code> for fitting spatio-temporal epidemic intensity
models to epidemic data.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co">## Generate a data frame containing a hypothetic population with 100 individuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, x<span class="op">=</span><span class="va">pos</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, y<span class="op">=</span><span class="va">pos</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>                  gender<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, <span class="va">n</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                  I0col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">-</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>, <span class="co"># 3 initially infectious</span></span>
<span>                  start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">n</span><span class="op">)</span>, stop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">Inf</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Simulate an SIR epidemic in this population</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">infPeriods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">/</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">3</span>, rate<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">epi</span> <span class="op">&lt;-</span> <span class="fu">simEpidata</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">stop</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="twinSIR_cox.html">cox</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">pop</span>,</span>
<span>    id.col <span class="op">=</span> <span class="st">"id"</span>, I0.col <span class="op">=</span> <span class="st">"I0col"</span>, coords.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>, h0 <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>B1<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>, f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B1<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="va">u</span><span class="op">&lt;=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>    infPeriod <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="va">infPeriods</span><span class="op">[</span><span class="va">ids</span><span class="op">]</span>,</span>
<span>    <span class="co">##remPeriod = function(ids) rexp(length(ids), rate=0.1), end = 30   # -&gt; SIRS</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## extract event times by id</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">epi</span><span class="op">)</span><span class="op">$</span><span class="va">byID</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot the numbers of susceptible, infectious and removed individuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">epi</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## load the 1861 Hagelloch measles epidemic</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"hagelloch"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hagelloch</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hagelloch</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## fit a simplistic twinSIR model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="twinSIR.html">twinSIR</a></span><span class="op">(</span><span class="op">~</span> <span class="va">household</span>, data <span class="op">=</span> <span class="va">hagelloch</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simulate a new epidemic from the above model</span></span>
<span><span class="co">## with simulation period = observation period, re-using observed infPeriods</span></span>
<span><span class="va">sim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">hagelloch</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## check if we find similar parameters in the simulated epidemic</span></span>
<span><span class="va">fitsim1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">sim1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, new <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitsim1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="surveillance.options.html">surveillance.options</a></span><span class="op">(</span><span class="st">"allExamples"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co">## simulate only 10 days, using random infPeriods ~ Exp(0.1)</span></span>
<span><span class="va">sim2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">hagelloch</span>, seed <span class="op">=</span> <span class="fl">2</span>, end <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    infPeriod <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span>, rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## simulate from a different model with manually specified parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span><span class="va">simepi</span> <span class="op">&lt;-</span> <span class="fu">simEpidata</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="twinSIR_cox.html">cox</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">hagelloch</span>,</span>
<span>    beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, h0 <span class="op">=</span> <span class="op">-</span><span class="fl">4</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>household <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>household <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="va">u</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    infPeriod <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ids</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ids</span><span class="op">)</span>, rate<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simepi</span><span class="op">)</span></span>
<span><span class="fu"><a href="intensityplot.html">intensityplot</a></span><span class="op">(</span><span class="va">simepi</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## see if we correctly estimate the parameters</span></span>
<span><span class="va">fitsimepi</span> <span class="op">&lt;-</span> <span class="fu"><a href="twinSIR.html">twinSIR</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="twinSIR_cox.html">cox</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span> <span class="op">+</span> <span class="va">household</span>, data <span class="op">=</span> <span class="va">simepi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>true <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="op">-</span><span class="fl">4</span>, <span class="fl">0.1</span><span class="op">)</span>, est <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitsimepi</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fitsimepi</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by <a href="https://www.imbe.med.fau.de/person/sebastian-meyer" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000. Hosted on <a href="https://R-forge.R-project.org/projects/surveillance/" class="external-link"><img src="https://r-forge.r-project.org/themes/rforge/imagesrf/logo.png" height="18" alt="R-Forge"></a></p>
</div>

    </footer></div>



  </body></html>

