<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a Two-Component Spatio-Temporal Point Process Model — twinstim • surveillance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a Two-Component Spatio-Temporal Point Process Model — twinstim"><meta name="description" content='A twinstim model as described in Meyer et al. (2012) is fitted to
  marked spatio-temporal point process data. This constitutes a
  regression approach for conditional intensity function modelling.
  The implementation is illustrated in Meyer et al. (2017, Section 3),
  see vignette("twinstim").'><meta property="og:description" content='A twinstim model as described in Meyer et al. (2012) is fitted to
  marked spatio-temporal point process data. This constitutes a
  regression approach for conditional intensity function modelling.
  The implementation is illustrated in Meyer et al. (2017, Section 3),
  see vignette("twinstim").'><!-- For Rd equations in pkgdown 2.1.0, see https://katex.org/docs/autorender.html --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
          throwOnError: false,
          macros: {"\\code": "\\texttt"}
      })
  });
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveillance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.23.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/events.html">Events</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a></li>
      </ul><ul class="navbar-nav"></ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a Two-Component Spatio-Temporal Point Process Model</h1>

      <div class="d-none name"><code>twinstim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A <code>twinstim</code> model as described in Meyer et al. (2012) is fitted to
  marked spatio-temporal point process data. This constitutes a
  regression approach for conditional intensity function modelling.
  The implementation is illustrated in Meyer et al. (2017, Section 3),
  see <code>vignette("twinstim")</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">twinstim</span><span class="op">(</span><span class="va">endemic</span>, <span class="va">epidemic</span>, <span class="va">siaf</span>, <span class="va">tiaf</span>, qmatrix <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">qmatrix</span>, <span class="va">data</span>,</span>
<span>         <span class="va">subset</span>, t0 <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">stgrid</span><span class="op">$</span><span class="va">start</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">stgrid</span><span class="op">$</span><span class="va">stop</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>         na.action <span class="op">=</span> <span class="va">na.fail</span>, start <span class="op">=</span> <span class="cn">NULL</span>, partial <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         epilink <span class="op">=</span> <span class="st">"log"</span>, control.siaf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, Deriv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         optim.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, finetune <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>         model <span class="op">=</span> <span class="cn">FALSE</span>, cumCIF <span class="op">=</span> <span class="cn">FALSE</span>, cumCIF.pb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>         cores <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-endemic">endemic<a class="anchor" aria-label="anchor" href="#arg-endemic"></a></dt>
<dd><p>right-hand side formula for the exponential (Cox-like
    multiplicative) endemic component. May contain offsets (to be marked
    by the special function <code>offset</code>).  If omitted or <code>~0</code>
    there will be no endemic component in the model.  A type-specific
    endemic intercept can be requested by including the term
    <code>(1|type)</code> in the formula.</p></dd>

  <dt id="arg-epidemic">epidemic<a class="anchor" aria-label="anchor" href="#arg-epidemic"></a></dt>
<dd><p>formula representing the epidemic model for the event-specific
    covariates (marks) determining infectivity. Offsets are not
    implemented here. If omitted or <code>~0</code> there will be no epidemic
    component in the model.</p></dd>

  <dt id="arg-siaf">siaf<a class="anchor" aria-label="anchor" href="#arg-siaf"></a></dt>
<dd><p>spatial interaction function. Possible specifications are:</p><ul><li><p><code>NULL</code> or missing, corresponding to
      <code><a href="twinstim_iaf.html">siaf.constant()</a></code>, i.e. spatially homogeneous
      infectivity independent of the distance from the host</p></li>
<li><p>a list as returned by <code><a href="twinstim_siaf.html">siaf</a></code> or, more commonly,
      generated by a predefined interaction function such as
      <code><a href="twinstim_iaf.html">siaf.gaussian</a></code> as in Meyer et al. (2012) or
      <code><a href="twinstim_iaf.html">siaf.powerlaw</a></code> as in Meyer and Held (2014).
      The latter requires unique event locations, possibly after random
      tie-breaking (<code><a href="untie.html">untie</a></code>) or imputation of
      interval-censored locations.
      <code><a href="twinstim_iaf.html">siaf.exponential</a></code> is a simpler alternative.</p></li>
<li><p>a numeric vector corresponding to the knots of a step
      function, i.e. the same as <code><a href="twinstim_iaf.html">siaf.step</a>(knots)</code></p></li>
</ul><p>If you run into “false convergence” with a non-constant
    <code>siaf</code> specification, the numerical accuracy of the cubature
    methods is most likely too low (see the <code>control.siaf</code>
    argument).</p></dd>

  <dt id="arg-tiaf">tiaf<a class="anchor" aria-label="anchor" href="#arg-tiaf"></a></dt>
<dd><p>temporal interaction function. Possible specifications are:</p><ul><li><p><code>NULL</code> or missing, corresponding to
      <code><a href="twinstim_iaf.html">tiaf.constant()</a></code>, i.e. time-constant infectivity</p></li>
<li><p>a list as returned by <code><a href="twinstim_tiaf.html">tiaf</a></code> or by a
      predefined interaction function such as
      <code><a href="twinstim_iaf.html">tiaf.exponential</a></code></p></li>
<li><p>a numeric vector corresponding to the knots of a step
      function, i.e. the same as <code><a href="twinstim_iaf.html">tiaf.step</a>(knots)</code></p></li>
</ul><p></p></dd>

  <dt id="arg-qmatrix">qmatrix<a class="anchor" aria-label="anchor" href="#arg-qmatrix"></a></dt>
<dd><p>square indicator matrix (0/1 or <code>FALSE</code>/<code>TRUE</code>) for
    possible transmission between the event types. The matrix will be
    internally converted to <code>logical</code>. Defaults to the \(Q\) matrix
    specified in <code>data</code>.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an object of class <code>"<a href="epidataCS.html">epidataCS</a>"</code>.</p></dd>

  <dt id="arg-subset">subset<a class="anchor" aria-label="anchor" href="#arg-subset"></a></dt>
<dd><p>an optional vector evaluating to logical indicating a subset of
    <code>data$events</code> to keep. Missing values are
    taken as <code>FALSE</code>. The expression is evaluated in the context of the
    <code>data$events@data</code> <code>data.frame</code>, i.e. columns of this
    <code>data.frame</code> may be referenced directly by name.</p></dd>

  <dt id="arg-t-t">t0, T<a class="anchor" aria-label="anchor" href="#arg-t-t"></a></dt>
<dd><p>events having occurred during (-Inf;t0] are regarded as part of the
    prehistory \(H_0\) of the process. Only events that occurred in the
    interval (t0; T] are considered in the likelihood.
    The time point <code>t0</code> (<code>T</code>) must
    be an element of <code>data$stgrid$start</code> (<code>data$stgrid$stop</code>).
    The default time range covers the whole spatio-temporal grid
    of endemic covariates.</p></dd>

  <dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>how to deal with missing values in <code>data$events</code>? Do not use
    <code><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.pass</a></code>. Missing values in the spatio-temporal grid
    <code>data$stgrid</code> are not accepted.</p></dd>

  <dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>a named vector of initial values for (a subset of) the parameters.
    The names must conform to the conventions of <code>twinstim</code> to be
    assigned to the correct model terms. For instance,
    <code>"h.(Intercept)"</code> = endemic intercept,
    <code>"h.I(start/365)"</code> = coefficient of a linear time
    trend in the endemic component, <code>"h.factorB"</code> =
    coefficient of the level B of the factor variable <code>factor</code> in
    the endemic predictor, <code>"e.(Intercept)"</code> = epidemic intercept,
    <code>"e.VAR"</code> = coefficient of the epidemic term <code>VAR</code>,
    <code>"e.siaf.2"</code> = second <code>siaf</code> parameter,
    <code>"e.tiaf.1"</code> = first <code>tiaf</code> parameter.
    Elements which don't match any of the model parameters are ignored.</p>
<p>Alternatively, <code>start</code> may also be a named list with elements
    <code>"endemic"</code> or <code>"h"</code>, <code>"epidemic"</code> or <code>"e"</code>,
    <code>"siaf"</code> or <code>"e.siaf"</code>, and <code>"tiaf"</code> or <code>"e.tiaf"</code>,
    each of which containing a named numeric vector with the term labels
    as names (i.e. without the prefix <code>"h."</code>, <code>"e."</code>, etc).
    Thus, <code>start=list(endemic=c("(Intercept)"=-10))</code> is equivalent
    to <code>start=c("h.(Intercept)"=-10)</code>.</p></dd>

  <dt id="arg-partial">partial<a class="anchor" aria-label="anchor" href="#arg-partial"></a></dt>
<dd><p>logical indicating if a partial likelihood similar to the approach
    by Diggle et al. (2010) should be used (default is <code>FALSE</code>).
    Note that the partial likelihood implementation is not well tested.</p></dd>

  <dt id="arg-epilink">epilink<a class="anchor" aria-label="anchor" href="#arg-epilink"></a></dt>
<dd><p>a character string determining the link function to be used for the
    <code>epidemic</code> linear predictor of event marks. By default, the
    log-link is used. The experimental alternative
    <code>epilink = "identity"</code> (for use by <code><a href="twinstim_epitest.html">epitest</a></code>) does
    not guarantee the force of infection to be positive. If this leads
    to a negative total intensity (endemic + epidemic), the point
    process is not well defined (the log-likelihood will be
    <code><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">NaN</a></code>).</p></dd>

  <dt id="arg-control-siaf">control.siaf<a class="anchor" aria-label="anchor" href="#arg-control-siaf"></a></dt>
<dd><p>a list with elements <code>"F"</code> and <code>"Deriv"</code>, which are lists
    of extra arguments passed to the functions <code>siaf$F</code> and
    <code>siaf$Deriv</code>, respectively.<br>
    These arguments control the accuracy of the cubature routines from
    package <span class="pkg">polyCub</span> involved in non-constant <code>siaf</code>
    specifications, e.g., the bandwidth of the midpoint rule
    <code><a href="https://rdrr.io/pkg/polyCub/man/polyCub.midpoint.html" class="external-link">polyCub.midpoint</a></code>, the number of Gaussian
    quadrature points for <code><a href="https://rdrr.io/pkg/polyCub/man/polyCub.SV.html" class="external-link">polyCub.SV</a></code>, or the relative
    tolerance of <code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></code> in <code><a href="https://rdrr.io/pkg/polyCub/man/polyCub.iso.html" class="external-link">polyCub.iso</a></code>.<br>
    For instance, <code><a href="twinstim_iaf.html">siaf.gaussian</a>(F.adaptive = TRUE)</code> uses the
    midpoint-cubature <code><a href="https://rdrr.io/pkg/polyCub/man/polyCub.midpoint.html" class="external-link">polyCub.midpoint</a></code> with an
    adaptive bandwidth of <code>eps=adapt*sd</code> to numerically integrate the
    kernel \(f(\bold{s})\), and the default <code>adapt</code> value (0.1)
    can be overwritten by setting <code>control.siaf$F$adapt</code>.
    However, the default version <code><a href="twinstim_iaf.html">siaf.gaussian()</a></code>
    as well as <code><a href="twinstim_iaf.html">siaf.powerlaw</a>()</code> and friends use
    <code><a href="https://rdrr.io/pkg/polyCub/man/polyCub.iso.html" class="external-link">polyCub.iso</a></code> and thus accept control arguments for the
    standard <code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></code> routine (such as <code>rel.tol</code>)
    via <code>control.siaf$F</code> and <code>control.siaf$Deriv</code>.<br>
    This argument list is ignored in the case
    <code>siaf=siaf.constant()</code> (which is the default if <code>siaf</code> is
    unspecified).</p></dd>

  <dt id="arg-optim-args">optim.args<a class="anchor" aria-label="anchor" href="#arg-optim-args"></a></dt>
<dd><p>an argument list passed to <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code>, or <code>NULL</code>, in
    which case no optimization will be performed
    but the necessary functions will be returned in a list (similar to
    what is returned if <code>model = TRUE</code>).</p>
<p>Initial values for the parameters may be given as list element
    <code>par</code> in the order <code>(endemic, epidemic, siaf, tiaf)</code>.
    If no initial values are provided, crude estimates will be used for
    the endemic intercept and the Gaussian kernel, -9 for the epidemic
    intercept, and zeroes for the remaining parameters.
    Any initial values given in the <code>start</code> argument
    take precedence over those in <code>par</code>.</p>
<p>Note that <code>optim</code> receives the negative log-likelihood for
    minimization (thus, if used, <code>optim.args$control$fnscale</code> should be
    positive). The <code>hessian</code> argument defaults to <code>TRUE</code>, and
    in the <code>control</code> list, <code>trace</code>ing is enabled with
    <code>REPORT=1</code> by default. By setting
    <code>optim.args$control$trace = 0</code>, all output from the
    optimization routine is suppressed.</p>
<p>For the <code>partial</code> likelihood, the analytic score function and
    the Fisher information are not implemented and the default is to use
    robust <code>method="Nelder-Mead"</code> optimization.</p>
<p>There may be an extra component <code>fixed</code> in the
    <code>optim.args</code> list, which determines which parameters should stick
    to their initial values. This can be specified by a
    logical vector of the same length as the <code>par</code> component, by an
    integer vector indexing <code>par</code> or by a character vector following
    the <code>twinstim</code> naming conventions. Furthermore, if
    <code>isTRUE(fixed)</code>, then all parameters are fixed at their initial
    values and no optimization is performed.</p>
<p>Importantly, the <code>method</code> argument in the <code>optim.args</code>
    list may also be <code>"nlminb"</code>, in
    which case the <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code> optimizer is used. This is also the
    default for full likelihood inference.
    In this case, not only the score function but also the
    <em>expected</em> Fisher information can be used during optimization (as
    estimated by what Martinussen and Scheike (2006, p. 64) call the
    “optional variation process”, or see Rathbun (1996, equation
    (4.7))). In our experience this gives better convergence than
    <code>optim</code>'s methods.
    For <code>method="nlminb"</code>, the following parameters of the
    <code>optim.args$control</code> list may be named like for
    <code>optim</code> and are renamed appropriately:
    <code>maxit</code> (-&gt; <code>iter.max</code>), <code>REPORT</code> (-&gt; <code>trace</code>,
    default: 1), <code>abstol</code> (-&gt; <code>abs.tol</code>), and
    <code>reltol</code> (-&gt; <code>rel.tol</code>, default: <code>1e-6</code>).
    For <code>nlminb</code>, a logical <code>hessian</code> argument (default:
    <code>TRUE</code>) indicates if the negative <em>expected</em> Fisher
    information matrix should be used as the Hessian during optimization
    (otherwise a numerical approximation is used).</p>
<p>Similarly, <code>method="nlm"</code> should also work but is not
    recommended here.</p></dd>

  <dt id="arg-finetune">finetune<a class="anchor" aria-label="anchor" href="#arg-finetune"></a></dt>
<dd><p>logical indicating if a second maximisation should be performed with
    robust Nelder-Mead <code>optim</code> using the resulting
    parameters from the first maximisation as starting point. This
    argument is only considered if <code>partial = FALSE</code> and the
    default is to not conduct a second maximization (in most cases this
    does not improve upon the MLE).</p></dd>

  <dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>logical indicating if the model environment should be kept with the
    result, which is required for
    <code><a href="twinstim_intensity.html">intensityplot</a></code>s and
    <code><a href="R0.html">R0</a>(..., trimmed = FALSE)</code>.
    Specifically, if <code>model=TRUE</code>, the return value will have the
    evaluation environment set as its <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></code>,
    and the returned <code>functions</code> element will contain the
    log-likelihood function (or partial log-likelihood function, if
    <code>partial = TRUE</code>), and optionally the score and the expected
    Fisher information functions (not for the partial likelihood, and
    only if <code>siaf</code> and <code>tiaf</code> provide the necessary
    derivatives).<br>
    Note that fitted objects with a model environment might consume
    quite a lot of memory since they contain the <code>data</code>.</p></dd>

  <dt id="arg-cumcif">cumCIF<a class="anchor" aria-label="anchor" href="#arg-cumcif"></a></dt>
<dd><p>logical (default: <code>FALSE</code>) indicating whether to
    calculate the fitted cumulative ground intensity at event times.
    This is the residual process, see <code><a href="residualsCT.html">residuals.twinstim</a></code>.</p></dd>

  <dt id="arg-cumcif-pb">cumCIF.pb<a class="anchor" aria-label="anchor" href="#arg-cumcif-pb"></a></dt>
<dd><p>logical indicating if a progress bar should be shown
    during the calculation of <code>cumCIF</code>. Defaults to do so in an
    interactive <span style="R">R</span> session, and will be <code>FALSE</code> if <code>cores != 1</code>.</p></dd>

  <dt id="arg-cores">cores<a class="anchor" aria-label="anchor" href="#arg-cores"></a></dt>
<dd><p>number of processes to use in parallel operation. By default
    <code>twinstim</code> runs in single-CPU mode. Currently, only the
    <span class="pkg">multicore</span>-type of parallel computing via forking is
    supported, which is not available on Windows, see
    <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></code> in package <span class="pkg">parallel</span>.
    Note that for a <span class="pkg">memoise</span>d <code><a href="twinstim_iaf.html">siaf.step</a></code> kernel,
    <code>cores=1</code> is fixed internally since parallelization would slow
    down model fitting significantly.</p></dd>

  <dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>logical indicating if information should be printed during
    execution. Defaults to <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs maximum likelihood inference
  for the additive-multiplicative spatio-temporal intensity model
  described in Meyer et al. (2012). It uses <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code> as the
  default optimizer and returns an object of class <code>"twinstim"</code>.
  Such objects have <code>print</code>, <code><a href="twinstim_plot.html">plot</a></code> and
  <code><a href="twinstim_methods.html">summary</a></code> methods.
  The <code>summary</code> output can be converted via corresponding
  <code><a href="twinstim_methods.html">xtable</a></code> or
  <code><a href="twinstim_methods.html">toLatex</a></code> methods.
  Furthermore, the usual accessor methods are implemented, including
  <code>coef</code>, <code>vcov</code>, <code>logLik</code>,
  <code><a href="residualsCT.html">residuals</a></code>, and
  <code>update</code>.
  Additional functionality is provided by the <code><a href="R0.html">R0</a></code> and
  <code><a href="twinstim_simulation.html">simulate</a></code> methods.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns an S3 object of class <code>"twinstim"</code>, which is a list with
  the following components:</p>
<p></p>
<dl><dt>coefficients</dt>
<dd><p>vector containing the MLE.</p></dd>

  <dt>loglik</dt>
<dd><p>value of the log-likelihood function at the MLE with a
    logical attribute <code>"partial"</code> indicating if the partial
    likelihood was used.</p></dd>

  <dt>counts</dt>
<dd><p>number of log-likelihood and score evaluations during
    optimization.</p></dd>

  <dt>converged</dt>
<dd><p>either <code>TRUE</code> (if the optimizer converged) or a
    character string containing a failure message.</p></dd>

  <dt>fisherinfo</dt>
<dd><p><em>expected</em> Fisher information evaluated at the
    MLE. Only non-<code>NULL</code> for full likelihood inference
    (<code>partial = FALSE</code>) and if spatial and temporal interaction
    functions are provided with their derivatives.</p></dd>

  <dt>fisherinfo.observed</dt>
<dd><p>observed Fisher information matrix
    evaluated at the value of the MLE. Obtained as the negative Hessian.
    Only non-<code>NULL</code> if <code>optim.args$method</code> is not
    <code>"nlminb"</code> and if it was requested by setting
    <code>hessian=TRUE</code> in <code>optim.args</code>.</p></dd>

  <dt>fitted</dt>
<dd><p>fitted values of the conditional intensity function at the events.</p></dd>

  <dt>fittedComponents</dt>
<dd><p>two-column matrix with columns <code>"h"</code> and
    <code>"e"</code> containing the fitted values of the endemic and epidemic
    components, respectively.<br>
    (Note that <code>rowSums(fittedComponents) == fitted</code>.)</p></dd>

  <dt>tau</dt>
<dd><p>fitted cumulative ground intensities at the event times.
    Only non-<code>NULL</code> if <code>cumCIF = TRUE</code>.
    This is the “residual process” of the model, see
    <code><a href="residualsCT.html">residuals.twinstim</a></code>.</p></dd>

  <dt>R0</dt>
<dd><p>estimated basic reproduction number for each event. This
    equals the spatio-temporal integral of the epidemic intensity over
    the observation domain (t0;T] x W for each event.</p></dd>

  <dt>npars</dt>
<dd><p>vector describing the lengths of the 5 parameter
    subvectors: endemic intercept(s) \(\beta_0(\kappa)\), endemic
    coefficients \(\beta\), epidemic coefficients \(\gamma\),
    parameters of the <code>siaf</code> kernel, and parameters of the
    <code>tiaf</code> kernel.</p></dd>

  <dt>qmatrix</dt>
<dd><p>the <code>qmatrix</code> associated with the epidemic
    <code>data</code> as supplied in the model call.</p></dd>

  <dt>bbox</dt>
<dd><p>the bounding box of <code>data$W</code>.</p></dd>

  <dt>timeRange</dt>
<dd><p>the time range used for fitting: <code>c(t0,T)</code>.</p></dd>

  <dt>formula</dt>
<dd><p>a list containing the four main parts of the model
    specification: <code>endemic</code>, <code>epidemic</code>, <code>siaf</code>, and
    <code>tiaf</code>.</p></dd>

  <dt>xlevels</dt>
<dd><p>a record of the levels of the factors used in fitting.</p></dd>

  <dt>control.siaf</dt>
<dd><p>see the “Arguments” section above.</p></dd>

  <dt>optim.args</dt>
<dd><p>input optimizer arguments used to determine the MLE.</p></dd>

  <dt>functions</dt>
<dd><p>if <code>model=TRUE</code> this is a <code>list</code> with
    components <code>ll</code>, <code>sc</code> and <code>fi</code>, which are functions
    evaluating the log-likelihood, the score function and the expected
    Fisher information for a parameter vector \(\theta\). The
    <code>environment</code> of these function is the model environment, which
    is thus retained in the workspace if <code>model=TRUE</code>. Otherwise,
    the <code>functions</code> component is <code>NULL</code>.</p></dd>

  <dt>call</dt>
<dd><p>the matched call.</p></dd>

  <dt>runtime</dt>
<dd><p>the <code><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></code>-queried time taken
    to fit the model, i.e., a named numeric vector of length 5 of class
    <code>"proc_time"</code>, with the number of <code>cores</code> set as
    additional attribute.</p></dd>


</dl><p>If <code>model=TRUE</code>, the model evaluation environment is assigned to
  this list and can thus be queried by calling <code><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment()</a></code> on
  the result.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><code>twinstim</code> makes use of the <span class="pkg">memoise</span> package if it is
  available – and that is highly recommended for non-constant
  <code>siaf</code> specifications to speed up calculations. Specifically, the
  necessary numerical integrations of the spatial interaction function
  will be cached such that they are only calculated once for every
  state of the <code>siaf</code> parameters during optimization.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Diggle, P. J., Kaimi, I. &amp; Abellana, R. (2010):
  Partial-likelihood analysis of spatio-temporal point-process data.
  <em>Biometrics</em>, <b>66</b>, 347-354.</p>
<p>Martinussen, T. and Scheike, T. H. (2006):
  Dynamic Regression Models for Survival Data.
  Springer.</p>
<p>Meyer, S. (2010):
  Spatio-Temporal Infectious Disease Epidemiology based on Point Processes.
  Master's Thesis, Ludwig-Maximilians-Universität
  München.<br>
  Available as <a href="https://epub.ub.uni-muenchen.de/11703/" class="external-link">https://epub.ub.uni-muenchen.de/11703/</a></p>
<p>Meyer, S., Elias, J. and Höhle, M. (2012):
  A space-time conditional intensity model for invasive meningococcal
  disease occurrence. <em>Biometrics</em>, <b>68</b>, 607-616.
  <a href="https://doi.org/10.1111/j.1541-0420.2011.01684.x" class="external-link">doi:10.1111/j.1541-0420.2011.01684.x</a></p>
<p>Meyer, S. and Held, L. (2014):
  Power-law models for infectious disease spread.
  <em>The Annals of Applied Statistics</em>, <b>8</b> (3), 1612-1639.
  <a href="https://doi.org/10.1214/14-AOAS743" class="external-link">doi:10.1214/14-AOAS743</a></p>
<p>Meyer, S., Held, L. and Höhle, M. (2017):
  Spatio-temporal analysis of epidemic phenomena using the <span style="R">R</span> package
  <span class="pkg">surveillance</span>.
  <em>Journal of Statistical Software</em>, <b>77</b> (11), 1-55.
  <a href="https://doi.org/10.18637/jss.v077.i11" class="external-link">doi:10.18637/jss.v077.i11</a></p>
<p>Rathbun, S. L. (1996):
  Asymptotic properties of the maximum likelihood estimator for
  spatio-temporal point processes.
  <em>Journal of Statistical Planning and Inference</em>, <b>51</b>, 55-74.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Meyer</p>
<p>Contributions to this documentation by
  Michael Höhle and Mayeul Kauffmann.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>vignette("twinstim")</code>.</p>
<p>There is a <code><a href="twinstim_simulation.html">simulate.twinstim</a></code> method,
  which simulates the point process based on the fitted <code>twinstim</code>.</p>
<p>A discrete-space alternative is offered by the <code><a href="twinSIR.html">twinSIR</a></code>
  modelling framework.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Load invasive meningococcal disease data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"imdepi"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### first, fit a simple endemic-only model</span></span>
<span></span>
<span><span class="va">m_noepi</span> <span class="op">&lt;-</span> <span class="fu">twinstim</span><span class="op">(</span></span>
<span>    endemic <span class="op">=</span> <span class="fu"><a href="addSeason2formula.html">addSeason2formula</a></span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">popdensity</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">start</span><span class="op">/</span><span class="fl">365</span><span class="op">-</span><span class="fl">3.5</span><span class="op">)</span>,</span>
<span>                                S<span class="op">=</span><span class="fl">1</span>, period<span class="op">=</span><span class="fl">365</span>, timevar<span class="op">=</span><span class="st">"start"</span><span class="op">)</span>,</span>
<span>    data <span class="op">=</span> <span class="va">imdepi</span>, subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">agegrp</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## look at the model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_noepi</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## there is no evidence for a type-dependent endemic intercept (LR test)</span></span>
<span><span class="va">m_noepi_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m_noepi</span>, endemic <span class="op">=</span> <span class="op">~</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">type</span><span class="op">)</span> <span class="op">+</span> <span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html" class="external-link">pchisq</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m_noepi_type</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m_noepi</span><span class="op">)</span><span class="op">)</span>, df<span class="op">=</span><span class="fl">1</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### add an epidemic component with just the intercept, i.e.</span></span>
<span><span class="co">### assuming uniform dispersal in time and space up to a distance of</span></span>
<span><span class="co">### eps.s = 200 km and eps.t = 30 days (see summary(imdepi))</span></span>
<span></span>
<span><span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m_noepi</span>, epidemic<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, model<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summarize the model fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m0</span>, correlation <span class="op">=</span> <span class="cn">TRUE</span>, symbolic.cor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## the default confint-method can be used for Wald-CI's</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">m0</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## same "untrimmed" R0 for every event (simple epidemic intercept model)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="R0.html">R0</a></span><span class="op">(</span><span class="va">m0</span>, trimmed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## plot the path of the fitted total intensity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m0</span>, <span class="st">"total intensity"</span>, tgrid<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="surveillance.options.html">surveillance.options</a></span><span class="op">(</span><span class="st">"allExamples"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="co">## extract "residual process" integrating over space (takes some seconds)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span>
<span><span class="co"># if the model describes the true CIF well _in the temporal dimension_,</span></span>
<span><span class="co"># then this residual process should behave like a stationary Poisson</span></span>
<span><span class="co"># process with intensity 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># easier, with CI and serial correlation:</span></span>
<span><span class="fu"><a href="checkResidualProcess.html">checkResidualProcess</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span>  <span class="co">## NB: in contrast to nlminb(), optim's BFGS would miss the</span></span>
<span>  <span class="co">##     likelihood maximum wrt the epidemic intercept</span></span>
<span>  <span class="va">m0_BFGS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m_noepi</span>, epidemic<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, optim.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"BFGS"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>nlminb<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span>, BFGS<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m0_BFGS</span><span class="op">)</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span>, scientific<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">m0_BFGS</span><span class="op">$</span><span class="va">fisherinfo</span>   <span class="co"># singular Fisher information matrix here</span></span>
<span>  <span class="va">m0</span><span class="op">$</span><span class="va">fisherinfo</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m0_BFGS</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">m0</span><span class="op">)</span></span>
<span>  <span class="co">## nlminb is more powerful since we make use of the analytical fisherinfo</span></span>
<span>  <span class="co">## as estimated by the model during optimization, which optim cannot</span></span>
<span><span class="op">}</span> <span class="co"># }</span></span>
<span></span>
<span></span>
<span><span class="co">### an epidemic-only model?</span></span>
<span><span class="co">## for a purely epidemic model, all events must have potential source events</span></span>
<span><span class="co">## (otherwise the intensity at the observed event would be 0)</span></span>
<span></span>
<span><span class="co">## let's focus on the C-type for this example</span></span>
<span><span class="va">imdepiC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">imdepi</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">imdepiC</span><span class="op">)</span><span class="op">$</span><span class="va">nSources</span><span class="op">)</span></span>
<span><span class="co">## 106 events have no prior, close events (in terms of eps.s and eps.t)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">twinstim</span><span class="op">(</span>epidemic <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">imdepiC</span><span class="op">)</span><span class="op">)</span>  <span class="co"># detects this problem</span></span>
<span><span class="co">## let's assume spatially unbounded interaction</span></span>
<span><span class="va">imdepiC_infeps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">imdepiC</span>, eps.s <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">imdepiC_infeps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">nSources</span><span class="op">)</span></span>
<span><span class="co">## for 11 events, there is no prior event within eps.t = 30 days</span></span>
<span><span class="co">## (which is certainly true for the first event)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">$</span><span class="va">counter</span>, main <span class="op">=</span> <span class="st">"Number of infectious individuals over time (eps.t = 30)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rug.html" class="external-link">rug</a></span><span class="op">(</span><span class="va">imdepiC_infeps</span><span class="op">$</span><span class="va">events</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rug.html" class="external-link">rug</a></span><span class="op">(</span><span class="va">imdepiC_infeps</span><span class="op">$</span><span class="va">events</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="va">s</span><span class="op">$</span><span class="va">nSources</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">## An endemic component would catch such events (from unobserved sources),</span></span>
<span><span class="co">## otherwise a longer infectious period would need to be assumed and</span></span>
<span><span class="co">## for the first event to happen, a prehistory is required (e.g., t0 = 31).</span></span>
<span><span class="co">## As an example, we fit the data only until T = 638 (all events have ancestors)</span></span>
<span><span class="va">m_epi</span> <span class="op">&lt;-</span> <span class="fu">twinstim</span><span class="op">(</span>epidemic <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">imdepiC_infeps</span>, t0 <span class="op">=</span> <span class="fl">31</span>, T <span class="op">=</span> <span class="fl">638</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_epi</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="surveillance.options.html">surveillance.options</a></span><span class="op">(</span><span class="st">"allExamples"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/source.html" class="external-link">withAutoprint</a></span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span><span class="co">### full model with interaction functions (time-consuming)</span></span>
<span><span class="co">## estimate an exponential temporal decay of infectivity</span></span>
<span><span class="va">m1_tiaf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m0</span>, tiaf<span class="op">=</span><span class="fu"><a href="twinstim_iaf.html">tiaf.exponential</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1_tiaf</span>, <span class="st">"tiaf"</span>, scaled<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## estimate a step function for spatial interaction</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sourceDists</span> <span class="op">&lt;-</span> <span class="fu"><a href="epidataCS.html">getSourceDists</a></span><span class="op">(</span><span class="va">imdepi</span>, <span class="st">"space"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">sourceDists</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">40</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m1_fstep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m0</span>, siaf<span class="op">=</span><span class="va">knots</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1_fstep</span>, <span class="st">"siaf"</span>, scaled<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rug.html" class="external-link">rug</a></span><span class="op">(</span><span class="va">sourceDists</span>, ticksize<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## estimate a continuously decreasing spatial interaction function,</span></span>
<span><span class="co">## here we use the kernel of an isotropic bivariate Gaussian</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m0</span>, siaf <span class="op">=</span> <span class="fu"><a href="twinstim_iaf.html">siaf.gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">m_noepi</span>, <span class="va">m0</span>, <span class="va">m1_fstep</span>, <span class="va">m1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>  <span class="co"># e.siaf.1 is log(sigma), no test for H0: log(sigma) = 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"e.siaf.1"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># a confidence interval for sigma</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m1</span>, <span class="st">"siaf"</span>, scaled<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">## alternative: siaf.powerlaw() with eps.s=Inf and untie()d data,</span></span>
<span><span class="co">##              see vignette("twinstim")</span></span>
<span></span>
<span><span class="co">## add epidemic covariates</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m1</span>, epidemic <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">agegrp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">m2</span><span class="op">)</span>   <span class="co"># further improvement</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">## look at estimated R0 values by event type</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="R0.html">R0</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="va">imdepi</span><span class="op">$</span><span class="va">events</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="R0.html">R0</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">)</span>, <span class="st">"type"</span><span class="op">]</span>, <span class="va">summary</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by <a href="https://www.imbe.med.fau.de/person/sebastian-meyer" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000. Hosted on <a href="https://R-forge.R-project.org/projects/surveillance/" class="external-link"><img src="https://r-forge.r-project.org/themes/rforge/imagesrf/logo.png" height="18" alt="R-Forge"></a></p>
</div>

    </footer></div>



  </body></html>

