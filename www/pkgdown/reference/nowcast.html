<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Adjust a univariate time series of counts for observed but-not-yet-reported events — nowcast • surveillance</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjust a univariate time series of counts for observed but-not-yet-reported events — nowcast"><meta name="description" content="Nowcasting can help to obtain up-to-date information on trends during
  a situation where reports about events arrive with delay. For example
  in public health reporting, reports about important
  indicators (such as occurrence of cases) are prone to be delayed due to
  for example manual quality checking and reporting system
  hierarchies. Altogether, the delays are subject to a delay distribution,
  which may, or may not, vary over time."><meta property="og:description" content="Nowcasting can help to obtain up-to-date information on trends during
  a situation where reports about events arrive with delay. For example
  in public health reporting, reports about important
  indicators (such as occurrence of cases) are prone to be delayed due to
  for example manual quality checking and reporting system
  hierarchies. Altogether, the delays are subject to a delay distribution,
  which may, or may not, vary over time."><!-- For Rd equations in pkgdown 2.1.0, see https://katex.org/docs/autorender.html --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous"></script><script>
  document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
          throwOnError: false,
          macros: {"\\code": "\\texttt"}
      })
  });
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">surveillance</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.25.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pkgdown/overview.html">Overview</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/events.html">Events</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/pkgdown/bibliography.html">Bibliography</a></li>
      </ul><ul class="navbar-nav"></ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Adjust a univariate time series of counts for observed but-not-yet-reported events</h1>

      <div class="d-none name"><code>nowcast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Nowcasting can help to obtain up-to-date information on trends during
  a situation where reports about events arrive with delay. For example
  in public health reporting, reports about important
  indicators (such as occurrence of cases) are prone to be delayed due to
  for example manual quality checking and reporting system
  hierarchies. Altogether, the delays are subject to a delay distribution,
  which may, or may not, vary over time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nowcast</span><span class="op">(</span><span class="va">now</span>, <span class="va">when</span>, <span class="va">data</span>, dEventCol<span class="op">=</span><span class="st">"dHospital"</span>, dReportCol<span class="op">=</span><span class="st">"dReport"</span>,</span>
<span>        method<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bayes.notrunc"</span>, <span class="st">"bayes.notrunc.bnb"</span>, <span class="st">"lawless"</span>,</span>
<span>                 <span class="st">"bayes.trunc"</span>, <span class="st">"unif"</span>, <span class="st">"bayes.trunc.ddcp"</span><span class="op">)</span>,</span>
<span>        aggregate.by<span class="op">=</span><span class="st">"1 day"</span>,</span>
<span>        D<span class="op">=</span><span class="fl">15</span>,</span>
<span>        m<span class="op">=</span><span class="cn">NULL</span>, m.interpretation<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hoehle_anderheiden2014"</span>, <span class="st">"lawless1994"</span><span class="op">)</span>,</span>
<span>        control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>            dRange<span class="op">=</span><span class="cn">NULL</span>, alpha<span class="op">=</span><span class="fl">0.05</span>, nSamples<span class="op">=</span><span class="fl">1e3</span>,</span>
<span>            N.tInf.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisgamma"</span>,<span class="st">"pois"</span>,<span class="st">"unif"</span><span class="op">)</span>,</span>
<span>            N.tInf.max<span class="op">=</span><span class="fl">300</span>, gd.prior.kappa<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>            ddcp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ddChangepoint<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                      cp_order<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"zero"</span>,<span class="st">"one"</span><span class="op">)</span>,</span>
<span>                      Wextra<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                      logLambda<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iidLogGa"</span>,<span class="st">"tps"</span>,<span class="st">"rw1"</span>,<span class="st">"rw2"</span><span class="op">)</span>,</span>
<span>                      responseDistr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"negbin"</span><span class="op">)</span>,</span>
<span>                      mcmc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">2500</span>, sample<span class="op">=</span><span class="fl">10000</span>, thin<span class="op">=</span><span class="fl">1</span>, adapt<span class="op">=</span><span class="fl">1000</span>,</span>
<span>                             store.samples<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            score<span class="op">=</span><span class="cn">FALSE</span>, predPMF<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-now">now<a class="anchor" aria-label="anchor" href="#arg-now"></a></dt>
<dd><p>an object of class <code>Date</code> denoting the day at which to do the
    nowcast. This corresponds to \(T\) in the notation of
    Höhle and an der Heiden (2014).</p></dd>

  <dt id="arg-when">when<a class="anchor" aria-label="anchor" href="#arg-when"></a></dt>
<dd><p>a vector of <code>Date</code> objects denoting the day(s) for which
    the projections are to be done. One needs to ensure that each
    element in <code>when</code> is smaller or equal to <code>now</code>.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame with one row per case – for each case on needs
    information on the day of the event (e.g. hospitalization) and the
    day of report of this event.</p></dd>

  <dt id="arg-deventcol">dEventCol<a class="anchor" aria-label="anchor" href="#arg-deventcol"></a></dt>
<dd><p>The name of the column in <code>data</code> which contains the
    date of the event, e.g. hospitalization. Default: <code>"dHospital"</code>.</p></dd>

  <dt id="arg-dreportcol">dReportCol<a class="anchor" aria-label="anchor" href="#arg-dreportcol"></a></dt>
<dd><p>Name of the column in <code>data</code> containing the date at
    which the report arrives at the respective register. Default:
    <code>"dReport"</code>.</p></dd>

  <dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>A vector of strings denoting the different methods for doing
    the nowcasting. Note that results of the first name in this list are
    officially
    returned by the function. However, it is possible to specify several
    methods here, e.g., in order to compare score evaluations. Details of
    the methods are described in Höhle and an der Heiden (2014).</p><dl><dt><code>"unif"</code></dt>
<dd></dd>

      <dt><code>"bayes.notrunc"</code></dt>
<dd><p>A Bayesian procedure ignoring
	truncation.</p></dd>

      <dt><code>"bayes.notrunc.bnb"</code></dt>
<dd><p>A fast Bayesian procedure ignoring
	truncation and which calculates the adjustment per-time
	(i.e. ignoring other delays) using the negative binomial.</p></dd>

      <dt><code>"lawless"</code></dt>
<dd><p>A discretized version of the Gaussian
	predictive distribution suggested in Lawless (1994).</p></dd>

      <dt><code>"bayes.trunc"</code></dt>
<dd><p>Bayesian method based on the generalized
	Dirichlet distribution, which is the conjugate prior-posterior for the
	delay distribution PMF under right-truncated sampling as shown in HadH
	(2014).</p></dd>

      <dt><code>"bayes.trunc.ddcp"</code></dt>
<dd><p>Fully Bayesian method allowing for
	change-points in the delay distribution, e.g., due to speed-ups
	in the reporting process. A discrete-survival
	model is used for the delay distribution. Details of
	the methods are described in HadH (2014). Note: This method
	requires that the JAGS program is installed on the system.</p></dd>


</dl><p></p></dd>

  <dt id="arg-aggregate-by">aggregate.by<a class="anchor" aria-label="anchor" href="#arg-aggregate-by"></a></dt>
<dd><p>Time scale used for the temporal aggregation of
    the records in the data <code>data</code>. See
    <code><a href="linelist2sts.html">linelist2sts</a></code> and <code><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></code> for further
  information.</p></dd>

  <dt id="arg-d">D<a class="anchor" aria-label="anchor" href="#arg-d"></a></dt>
<dd><p>Maximum possible or maximum relevant delay (unit:
    <code>aggregate.by</code>). Default: 15.</p></dd>

  <dt id="arg-m">m<a class="anchor" aria-label="anchor" href="#arg-m"></a></dt>
<dd><p>Size of the moving window for the estimation of the delay
    distribution. Default: <code>NULL</code>, i.e. take all values at all
  times. Otherwise: a positive integer equal to or greater than <code>D</code>
  such that only values from a sliding window are used. The shape of the
  window depends on the value of <code>m.interpretation</code>.</p></dd>

  <dt id="arg-m-interpretation">m.interpretation<a class="anchor" aria-label="anchor" href="#arg-m-interpretation"></a></dt>
<dd><p>This parameter controls the interpretation of
  the sliding window used to estimate the delay distribution. If
  <code>m.interpretation="hoehle_anderheiden2014"</code> (Default) then the
  sliding window is defined as a horizontal cut in the reporting
  triangle, i.e. the values for the delay estimation originate from
  reports occurring during <code>(now-m):now</code>. This means that the estimation of long delays is
  based on fewer observations than the estimation of the short delays,
  hence, the long delay estimates are subject to more variability. If
  for example \(m=D\) then the estimate for a delay of \(d=D\) is
  based on only one observation.
  The advantage of this choice is that one explicitly knows which time
  period all observations originate from. For details see Section 3 of
  Höhle and an der Heiden (2014).</p>
<p>Alternatively, when <code>m.interpretation</code>="lawless1994", the cut in
  the reporting triangle is made such that each delay <code>d</code> is
  estimated based on the same number of observations (\(m+1\)). This
  means that in order to estimate the delay for \(d\) days, a
  sliding rectangle of length \(m+1\) containing the reports which
  occurred during <code>(now-m-d):now</code>. See Fig. 2 in Lawless (1994) for
  details. Note: A warning is given is
  <code>method="lawless"</code>, but <code>m.interpretation</code> is not.</p></dd>

  <dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>A list with named arguments controlling the
    functionality of the nowcasting.</p><dl><dt>dRange</dt>
<dd><p>Default: <code>NULL</code>. In this case the
	<code>dEventCol</code> column is used to extract the first and last
	available in <code>data</code>.</p></dd>

      <dt>alpha</dt>
<dd><p>Equal tailed (1-\(\alpha\))*100% prediction
	intervals are calculated. Default: 0.05.</p></dd>

      <dt>nSamples</dt>
<dd><p>Number of PMF samples in the <code>bayes.*</code>
	procedures. Note: Entire vectors containing the PMF on the grid from 0
	to <code>N.tInf.max</code> are drawn and which are then combined. The
	argument does not apply to the <code>bayes.trunc.ddcp</code> method.</p></dd>

      <dt>N.tInf.prior</dt>
<dd><p>Prior distribution of
	\(N(t,\infty)\). Applies only to the <code>bayes.*</code> except
	<code>bayes.bayes.ddcp</code> methods. See example on how to control the
	distribution parameters.</p></dd>

      <dt>N.tInf.max</dt>
<dd><p>Limit of the support of \(N(t,\infty)\). The
	value needs to be high enough such that at this limit only little of
	the predictive distribution is right-truncated. Default: 300.</p></dd>

      <dt>gd.prior.kappa</dt>
<dd><p>Concentration parameter for the Dirichlet
	prior for the delay distribution on \(0,...,D\). Default: 0.1. Note:
	The procedure is quite sensitive to this parameter in case only few
	cases are available.</p></dd>

      <dt>ddcp</dt>
<dd><p>A list specifying the change point model for the delay
	distribution. This method should only be used if detailed information
	about changes in the delay distribution are available as, e.g., in the
	case of the STEC O104:H4 outbreak. The components are as
	follows:</p><dl><dt><code>ddChangepoint</code></dt>
<dd><p>Vector of Date objects corresponding
	    to the changepoints</p></dd>

	  <dt><code>cp_order</code></dt>
<dd><p>Either <code>"zero"</code> (Default) or
  <code>"one"</code>. This is the degree of the TPS spline for the baseline
  hazard, which is formed by the changepoints. Order zero corresponds to
  the dummy variables of the change-points being simply zero or one. In
  case a 1st order polynomial is chosen, this allows the delay
  distribution to change towards faster or slow reporting as time
  progresses (until the next change-point). The later can be helpful in
  very dynamic epidemic situations where a lot of cases suddenly appear
  overwhelming the surveillance system infrastructure.</p></dd>

	  <dt><code>Wextra</code></dt>
<dd><p>An additional design matrix part to be joined
  onto the part originating from the change-points. Altogether, the
  column bind of these two quantities will be \(W_{t,d}\). This allows
  one to include, e.g., day of the week effects or holidays.</p></dd>

	  <dt><code>logLambda</code></dt>
<dd><p>Prior on the spline. One of
	    <code>c("iidLogGa","tps","rw1","rw2")</code>.</p></dd>

	  <dt><code>respDistr</code></dt>
<dd><p>Response distribution of \(n_{t,d}\)
  in the reporting triangle. Default is <code>"poisson"</code>. An
  experimental alternative is to use <code>"negbin"</code>.</p></dd>

	  <dt><code>tau.gamma</code></dt>
<dd></dd>

	  <dt><code>eta.mu</code></dt>
<dd><p>Vector of coefficients describing the
  mean of the prior normal distribution of the regression effects in the
  discrete time survival model.</p></dd>

	  <dt><code>eta.prec</code></dt>
<dd><p>A precision matrix for the regression
  effects in the discrete time survival model.</p></dd>

	  <dt><code>mcmc</code></dt>
<dd><p>A named vector of length 5 containing
	    burn-in (default: 2500), number of samples (10000),
            thinning (1) and adaptation (1000) for the
            three MCMC chains which are ran. The values are passed on to
  <code><a href="https://rdrr.io/pkg/runjags/man/run.jags.html" class="external-link">run.jags</a></code>. The fifth argument <code>store.samples</code>
  denotes if the output of the JAGS sampling should be included as part of the
  returned <code>stsNC</code> object. Warning: If <code>TRUE</code> (Default: <code>FALSE</code>)
  the size of the returned object might increase substantially.</p></dd>

	
</dl><p></p></dd>

      <dt>score</dt>
<dd><p>Compute scoring rules. Default: <code>FALSE</code>. The
	computed scores are found in the <code>SR</code> slot of the result.</p></dd>

      <dt>predPMF</dt>
<dd><p>Boolean whether to return the probability mass
	functions of the individual forecasts (Default: <code>FALSE</code>). The
	result can be found in the <code>control</code> slot of the return object.</p></dd>


</dl><p></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The methodological details of the nowcasting procedures are described in
  Höhle M and an der Heiden M (2014).</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>nowcast</code> returns an object of <code>"<a href="stsNC-class.html">stsNC</a>"</code>. The
  <code>upperbound</code> slot contains the median of the method specified at
  the first position the argument <code>method</code>. The slot <code>pi</code> (for
  prediction interval)
  contains the equal tailed (1-\(\alpha\))*100% prediction
  intervals, which are calculated based on the predictive distributions
  in slot <code>predPMF</code>.
  Furthermore, slot <code>truth</code> contains an <code>sts</code> object
  containing the true number of cases (if possible to compute it is based on
  the data in <code>data</code>). Finally, slot <code>SR</code> contains the results
  for the proper scoring rules (requires truth to be calculable).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Höhle, M. and an der Heiden, M. (2014): Bayesian nowcasting
  during the STEC O104:H4 outbreak in Germany, 2011. <em>Biometrics</em>
  70(4):993-1002. <a href="https://doi.org/10.1111/biom.12194" class="external-link">doi:10.1111/biom.12194</a>
.<br>
  A preprint is available as
  <a href="https://staff.math.su.se/hoehle/pubs/hoehle_anderheiden2014-preprint.pdf" class="external-link">https://staff.math.su.se/hoehle/pubs/hoehle_anderheiden2014-preprint.pdf</a>.</p>
<p>Günther, F. and Bender, A. and Katz, K. and
  Küchenhoff, H. and Höhle, M. (2020):
  Nowcasting the COVID-19 pandemic in Bavaria.
  <em>Biometrical Journal</em>. <a href="https://doi.org/10.1002/bimj.202000112" class="external-link">doi:10.1002/bimj.202000112</a>
<br>
  Preprint available at <a href="https://doi.org/10.1101/2020.06.26.20140210" class="external-link">doi:10.1101/2020.06.26.20140210</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Höhle</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Note: The <code>bayes.trunc.ddcp</code> uses the JAGS software together with
  the <span style="R">R</span> package <span class="pkg">runjags</span> to handle the parallelization of
  the MCMC using the <code>"rjparallel"</code> method of
  <code><a href="https://rdrr.io/pkg/runjags/man/run.jags.html" class="external-link">run.jags</a></code>, which additionally requires the
  <span class="pkg">rjags</span> package. You need to manually install
  JAGS on your computer for the package to work – see
  <a href="https://mcmc-jags.sourceforge.io/" class="external-link">https://mcmc-jags.sourceforge.io/</a>
  and the documentation of <span class="pkg">runjags</span> for details.</p>
<p>Note: The function is still under development and might change in the
  future. Unfortunately, little emphasis has so far been put on making
  the function easy to understand and use.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"husO104Hosp"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Extract the reporting triangle at a specific day</span></span>
<span><span class="va">t.repTriangle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-07-04"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Use 'void' nowcasting procedure (we just want the reporting triangle)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">nowcast</span><span class="op">(</span>now<span class="op">=</span><span class="va">t.repTriangle</span>,when<span class="op">=</span><span class="va">t.repTriangle</span>,</span>
<span>              dEventCol<span class="op">=</span><span class="st">"dHosp"</span>,dReportCol<span class="op">=</span><span class="st">"dReport"</span>,data<span class="op">=</span><span class="va">husO104Hosp</span>,</span>
<span>              D<span class="op">=</span><span class="fl">15</span>,method<span class="op">=</span><span class="st">"unif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Show reporting triangle</span></span>
<span><span class="fu"><a href="stsNC-class.html">reportingTriangle</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Perform Bayesian nowcasting assuming the delay distribution is stable over time</span></span>
<span><span class="va">nc.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>N.tInf.prior<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="st">"poisgamma"</span>,</span>
<span>                                mean.lambda<span class="op">=</span><span class="fl">50</span>,var.lambda<span class="op">=</span><span class="fl">3000</span><span class="op">)</span>,</span>
<span>                                nSamples<span class="op">=</span><span class="fl">1e2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t.repTriangle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-06-10"</span><span class="op">)</span></span>
<span><span class="va">when</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">t.repTriangle</span><span class="op">-</span><span class="fl">3</span>,length.out<span class="op">=</span><span class="fl">10</span>,by<span class="op">=</span><span class="st">"-1 day"</span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">nowcast</span><span class="op">(</span>now<span class="op">=</span><span class="va">t.repTriangle</span>,when<span class="op">=</span><span class="va">when</span>,</span>
<span>              dEventCol<span class="op">=</span><span class="st">"dHosp"</span>,dReportCol<span class="op">=</span><span class="st">"dReport"</span>,data<span class="op">=</span><span class="va">husO104Hosp</span>,</span>
<span>              D<span class="op">=</span><span class="fl">15</span>,method<span class="op">=</span><span class="st">"bayes.trunc"</span>,control<span class="op">=</span><span class="va">nc.control</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Show time series and posterior median forecast/nowcast</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nc</span>,xaxis.tickFreq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"%d"</span><span class="op">=</span><span class="va">atChange</span>,<span class="st">"%m"</span><span class="op">=</span><span class="va">atChange</span><span class="op">)</span>,</span>
<span>     xaxis.labelFreq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"%d"</span><span class="op">=</span><span class="va">at2ndChange</span><span class="op">)</span>,xaxis.labelFormat<span class="op">=</span><span class="st">"%d-%b"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Time (days)"</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span>
<span><span class="co">### Using runjags to do a Bayesian model with changepoint(s)</span></span>
<span><span class="co">### -- this might take a while</span></span>
<span><span class="va">nc.control.ddcp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/modifyList.html" class="external-link">modifyList</a></span><span class="op">(</span><span class="va">nc.control</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>gd.prior.kappa<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>                         ddcp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ddChangepoint<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2011-05-23"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                             logLambda<span class="op">=</span><span class="st">"tps"</span>,</span>
<span>                             tau.gamma<span class="op">=</span><span class="fl">1</span>,</span>
<span>                             mcmc<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>burnin<span class="op">=</span><span class="fl">1000</span>,sample<span class="op">=</span><span class="fl">1000</span>,thin<span class="op">=</span><span class="fl">1</span>,</span>
<span>                                    adapt<span class="op">=</span><span class="fl">1000</span>,store.samples<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nc.ddcp</span> <span class="op">&lt;-</span> <span class="fu">nowcast</span><span class="op">(</span>now<span class="op">=</span><span class="va">t.repTriangle</span>,when<span class="op">=</span><span class="va">when</span>,</span>
<span>               dEventCol<span class="op">=</span><span class="st">"dHosp"</span>,dReportCol<span class="op">=</span><span class="st">"dReport"</span>,</span>
<span>               data<span class="op">=</span><span class="va">husO104Hosp</span>, aggregate.by<span class="op">=</span><span class="st">"1 day"</span>,</span>
<span>               method<span class="op">=</span><span class="st">"bayes.trunc.ddcp"</span>, D<span class="op">=</span><span class="fl">15</span>,</span>
<span>                   control<span class="op">=</span><span class="va">nc.control.ddcp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nc.ddcp</span>,legend.opts<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>     xaxis.tickFreq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"%d"</span><span class="op">=</span><span class="va">atChange</span>,<span class="st">"%m"</span><span class="op">=</span><span class="va">atChange</span><span class="op">)</span>,</span>
<span>     xaxis.labelFreq<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"%d"</span><span class="op">=</span><span class="va">at2ndChange</span><span class="op">)</span>,xaxis.labelFormat<span class="op">=</span><span class="st">"%d-%b"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Time (days)"</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="fu"><a href="stsNC-class.html">delayCDF</a></span><span class="op">(</span><span class="va">nc.ddcp</span><span class="op">)</span><span class="op">[[</span><span class="st">"bayes.trunc.ddcp"</span><span class="op">]</span><span class="op">]</span>,<span class="st">"model"</span><span class="op">)</span><span class="op">$</span><span class="va">lambda</span></span>
<span><span class="va">showIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">when</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="stsSlots.html">epoch</a></span><span class="op">(</span><span class="va">nc.ddcp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#seq(ncol(lambda))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matlines</a></span><span class="op">(</span> <span class="va">showIdx</span>,<span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span><span class="op">[</span><span class="va">showIdx</span>,<span class="op">]</span>,col<span class="op">=</span><span class="st">"gray"</span>,lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">lambda</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span>,<span class="st">"95% CI"</span><span class="op">)</span>,col<span class="op">=</span><span class="st">"gray"</span>,lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="co"># }</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Maintained by <a href="https://www.imbe.med.fau.de/person/sebastian-meyer" class="external-link">Sebastian Meyer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000. Hosted on <a href="https://R-forge.R-project.org/projects/surveillance/" class="external-link"><img src="https://r-forge.r-project.org/themes/rforge/imagesrf/logo.png" height="18" alt="R-Forge"></a></p>
</div>

    </footer></div>



  </body></html>

