
R version 4.3.2 (2023-10-31) -- "Eye Holes"
Copyright (C) 2023 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ################################################################################
> ### Demo of hhh4() modelling of influenza in Southern Germany - data("fluBYBW")
> ### based on
> ###
> ### Paul, M. and Held, L. (2011): Predictive assessment of a non-linear random
> ### effects model for multivariate time series of infectious disease counts.
> ### Statistics in Medicine, 30, 1118-1136.
> ###
> ### RUNNING THE WHOLE SCRIPT TAKES ~20 MINUTES!
> ###
> ### Copyright (C) 2009-2012 Michaela Paul, 2012-2013,2016-2019 Sebastian Meyer
> ###
> ### This file is part of the R package "surveillance",
> ### free software under the terms of the GNU General Public License, version 2,
> ### a copy of which is available at http://www.r-project.org/Licenses/.
> ################################################################################
> 
> library("surveillance")
Loading required package: sp
Loading required package: xtable
This is surveillance 1.22.1; see ‘package?surveillance’ or
https://surveillance.R-Forge.R-project.org/ for an overview.
> 
> ## Reproducibility
> set.seed(1)  # affects initial values for ri() terms
> options(digits = 5)  # avoid machine-specific output
> 
> ## Weekly counts of influenza in 140 districts of Bavaria and Baden-Wuerttemberg
> data("fluBYBW")  # data corrected in surveillance 1.6-0
>                  # -> minor differences to original results in the paper
> 
> 
> ##################################################
> # Fit the models from the Paul & Held (2011) paper
> ##################################################
> 
> ## generate formula for temporal and seasonal trends
> f.end <- addSeason2formula(f = ~ -1 + ri(type="iid", corr="all") +
+                                I((t-208)/100), S=3, period=52)
> 
> ## settings for the optimizer
> opt <- list(stop = list(tol=1e-5, niter=200),
+             regression = list(method="nlminb"),
+             variance = list(method="nlminb"))
> 
> ## models
> # A0
> cntrl_A0 <- list(ar = list(f = ~ -1),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose = 1)
> summary(res_A0 <- hhh4(fluBYBW,cntrl_A0))
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.3981 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.59208 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.14754 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.33894 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.035505 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.097746 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0068082 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.019769 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0012437 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0036503 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002251 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00066201 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.0723e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00011979 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.358e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.1647e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.3294e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.9111e-06 

Optimization converged

Call: 
hhh4(stsObj = fluBYBW, control = cntrl_A0)

Random effects:
            Var   Corr
end.ri(iid) 0.789     

Fixed effects:
                        Estimate  Std. Error
end.I((t - 208)/100)     0.6744    0.0139   
end.sin(2 * pi * t/52)   2.8035    0.0983   
end.cos(2 * pi * t/52)   2.7117    0.1117   
end.sin(4 * pi * t/52)   0.5911    0.0946   
end.cos(4 * pi * t/52)  -0.4752    0.0842   
end.sin(6 * pi * t/52)   0.0317    0.0494   
end.cos(6 * pi * t/52)  -0.4176    0.0497   
end.ri(iid)              0.5208    0.1087   
overdisp                 2.0523    0.0519   

Penalized log-likelihood:  -20143 
Marginal log-likelihood:   -314.2 

Number of units:        140 
Number of time points:  415 

> 
> # B0
> cntrl_B0 <- list(ar = list(f = ~ 1),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B0 <- hhh4(fluBYBW,cntrl_B0)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2366 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.1948 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.047037 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.070918 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.014057 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.020841 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0038585 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0056941 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0010337 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0015236 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00027507 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00040535 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.3139e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00010771 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.9418e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.8608e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.1564e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.5967e-06 

Optimization converged
> 
> # C0
> cntrl_C0 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_C0 <- hhh4(fluBYBW,cntrl_C0)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2318 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.56336 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.10063 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.21534 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.049436 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.11853 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.028984 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.07543 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.018631 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.051924 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.012738 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.037534 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0090966 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.028041 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0067076 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.021444 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0050667 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.016684 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0038987 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.01315 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0030436 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.010469 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0024032 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0083992 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0019148 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0067804 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0015368 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0055006 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0012406 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0044799 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0010159 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0036603 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00083471 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0029983 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00068763 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0024613 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00056766 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0020239 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00046939 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0016666 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00038866 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001374 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00032218 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0011338 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00026724 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00093637 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00022183 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00077381 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00018423 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00063981 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00015309 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00052926 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00012722 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00043796 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00010575 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00036253 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.792e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00030016 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.3101e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00024857 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.0784e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00020589 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.0543e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00017056 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.2027e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00014132 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.4949e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00011709 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.9057e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.7019e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.4155e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.0405e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.0083e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.6631e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.6693e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.5225e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.3877e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.5772e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.1533e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.7936e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.5849e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.1445e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.9654e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.6064e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.6188e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.1604e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.4993e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.7909e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.569e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.4845e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.7956e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.2306e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.1529e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.0201e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.6188e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.4558e-06 

Optimization converged
> 
> 
> #A1
> 
> # weight matrix w_ji = 1/(No. neighbors of j) if j ~ i, and 0 otherwise
> wji <- neighbourhood(fluBYBW)/rowSums(neighbourhood(fluBYBW))
> 
> cntrl_A1 <- list(ar = list(f = ~ -1),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_A1 <- hhh4(fluBYBW,cntrl_A1)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2982 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.74362 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.19633 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.0531 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.073098 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.0872 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.022588 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.25002 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0064473 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.057321 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0018373 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.015467 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00052334 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0043401 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00014903 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0012306 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.2461e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00035026 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2096e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.9735e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.445e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.8403e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.8114e-07 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.0887e-06 

Optimization converged
> 
> # B1
> cntrl_B1 <- list(ar = list(f = ~ 1),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B1 <- hhh4(fluBYBW,cntrl_B1)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2026 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.38029 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.099156 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.24418 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.04042 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.11661 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.014722 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.045953 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0051414 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.016556 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0017691 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0057608 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00060564 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0019799 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00020693 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00067734 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.0703e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00023159 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.4151e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.9099e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.246e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.7011e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.8156e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.2229e-06 

Optimization converged
> 
> # C1
> cntrl_C1 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  ne = list(f = ~ 1, weights = wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_C1 <- hhh4(fluBYBW,cntrl_C1)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.1946 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.45266 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.10267 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.17603 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.045497 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.097065 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.026533 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.061797 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0171 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.042349 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.011652 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.030318 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0082464 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.02234 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0059961 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.016798 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.004447 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.012818 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0033472 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0098894 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.002575 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.007694 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0019987 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0060245 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00156 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0047408 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.001223 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0037451 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00096219 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0029676 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00075917 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0023572 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00060036 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0018759 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00047567 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0014952 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00037744 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0011932 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00029987 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0009531 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00023848 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00076195 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00018985 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00060952 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00015122 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00048784 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00012053 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00039062 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.6117e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00031289 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.6682e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0002507 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.1202e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00020095 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.8869e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00016105 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.902e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00012913 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.1174e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00010353 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.4905e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.3037e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.995e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.6599e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.599e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.3421e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2818e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.2854e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.0276e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.438e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.2391e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.7584e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.6065e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.2133e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.2981e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.776e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.2491e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.4252e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.408e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.1438e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.7336e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 9.1795e-06 

Optimization converged
> 
> 
> #A2
> cntrl_A2 <- list(ar = list(f = ~ -1),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights=wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_A2 <- hhh4(fluBYBW,cntrl_A2)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.2516 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.85929 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.27921 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.34923 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.10612 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.07041 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.028296 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.020139 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0077646 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0070178 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0024891 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0027875 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00093507 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0011909 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00041788 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00056989 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00019401 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00027349 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.0065e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00012973 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.1799e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.1274e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.9409e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.8904e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.0201e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.3632e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.1951e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.4312e-06 

Optimization converged
> 
> # B2
> cntrl_B2 <- list(ar = list(f = ~ 1),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights =wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1)
> res_B2 <- hhh4(fluBYBW,cntrl_B2)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.1739 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.68705 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.40759 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.52679 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.16057 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.15117 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.066938 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.054607 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.030204 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.024116 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.015304 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.012482 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0083307 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0071661 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0047136 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.004358 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00272 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0027291 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0015846 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001734 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00092704 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0011097 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00054294 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00071274 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00031789 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00045864 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00018554 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00029549 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00011099 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00019043 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.8141e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00012275 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.187e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.914e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.575e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.1029e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.585e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.2907e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.7641e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.1222e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.0772e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.3686e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.8058e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.8263e-06 

Optimization converged
> 
> # C2
> cntrl_C2 <- list(ar = list(f = ~ -1 + ri(type="iid", corr="all")),
+                  ne = list(f = ~ -1 + ri(type="iid",corr="all"), weights =wji),
+                  end = list(f =f.end, offset = population(fluBYBW)),
+                  family = "NegBin1", optimizer = opt, verbose=1,
+                  start=list(fixed=fixef(res_B0),random=c(rep(0,140),
+                          ranef(res_B0)), sd.corr=c(-.5,res_B0$Sigma.orig,0)))
> res_C2 <- hhh4(fluBYBW,cntrl_C2)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.82407 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.63946 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.42442 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.25341 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.20166 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.09971 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.071569 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.053096 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.034581 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.034348 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.021458 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.023084 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.013925 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.015915 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0093719 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.011168 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0065023 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0079357 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0046138 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0056906 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0033486 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0041083 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0024775 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0031011 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0018614 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.002383 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0014153 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.001837 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0010858 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0014194 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00083842 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0010986 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00065037 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00085123 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00050605 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00066004 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00039463 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.000512 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00030782 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00039726 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0002405 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00030823 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00018779 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00023914 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00014664 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0001855 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00011446 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00014387 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.9295e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00011154 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 6.9624e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.6452e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 5.4251e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 6.6989e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.2244e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.189e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.2874e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 4.0183e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.5565e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.1107e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.987e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.4075e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.5434e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.8627e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.1981e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.4408e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 9.2962e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.1141e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.2092e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 8.6132e-06 

Optimization converged
> 
> 
> # D
> cntrl_D <- list(ar = list(f = ~ 1),
+                 ne = list(f = ~ -1 + ri(type="iid"), weights = wji),
+                 end = list(f =addSeason2formula(f = ~ -1 + ri(type="car") +
+                                              I((t-208)/100), S=3, period=52),
+                           offset = population(fluBYBW)),
+                 family = "NegBin1", optimizer = opt, verbose=1)
> res_D <- hhh4(fluBYBW,cntrl_D)
Iterative optimization of regression & variance parameters

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.1615 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.71355 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.60872 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.0149 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.19405 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 32.533 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.089566 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.53631 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.047083 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.18703 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.024802 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.083499 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.013125 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.040749 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0069747 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.020734 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0037182 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.010786 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0019868 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0056821 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0010634 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0030155 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.0005698 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0016074 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00030562 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00085945 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 0.00016401 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.0004603 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 8.8049e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00024678 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 4.7279e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 0.00013242 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.5395e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 7.1083e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 1.3641e-05 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 3.817e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 7.3279e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 2.05e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 3.9368e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 1.1012e-05 

Update of regression parameters:  max|x_0 - x_1| / max|x_0| = 2.1151e-06 
Update of variance parameters:  max|x_0 - x_1| / max|x_0| = 5.9154e-06 

Optimization converged
> 
> 
> ###########################################################
> ## Exemplary summary of model B2
> ## (compare with Paul & Held, 2011, Table III and Figure 5)
> ###########################################################
> 
> summary(res_B2, idx2Exp = 1:2, maxEV = TRUE)

Call: 
hhh4(stsObj = fluBYBW, control = cntrl_B2)

Random effects:
            Var   Corr  
ne.ri(iid)  0.964       
end.ri(iid) 0.507 0.565 

Fixed effects:
                        Estimate  Std. Error
exp(ar.1)                0.4099    0.0151   
exp(ne.ri(iid))          0.2193    0.0227   
end.I((t - 208)/100)     0.5737    0.0237   
end.sin(2 * pi * t/52)   2.1787    0.0981   
end.cos(2 * pi * t/52)   2.3374    0.1213   
end.sin(4 * pi * t/52)   0.4516    0.1043   
end.cos(4 * pi * t/52)  -0.3767    0.0940   
end.sin(6 * pi * t/52)   0.3015    0.0645   
end.cos(6 * pi * t/52)  -0.2480    0.0629   
end.ri(iid)              0.2235    0.1022   
overdisp                 1.0844    0.0339   

Epidemic dominant eigenvalue:  0.71 

Penalized log-likelihood:  -18697 
Marginal log-likelihood:   -343.6 

Number of units:        140 
Number of time points:  415 

> ## Note: as of surveillance 1.6-0, results differ slightly from the paper
> ## (see penalized log-likelihood), because a superfluous row of zeros
> ## has been removed from the fluBYBW data
> 
> .idx <- c(113, 111, 46, 77)
> plot(res_B2, units = .idx, names = fluBYBW@map@data[.idx, "name"],
+      legend = 2, legend.args = list(x = "topleft"), legend.observed = TRUE)
> 
> 
> ######################################################################
> # Compare the predictive performance of the models by computing
> # one-step-ahead predictions to be assessed by proper scoring rules
> ######################################################################
> 
> ## do 1-step ahead predictions for the last two years
> 
> tp <- nrow(fluBYBW)-2*52
> verbose <- interactive()
> 
> ## for this demo: only calculate pseudo-predictions based on the final fit
> ## to avoid the time-consuming sequential refitting at each step.
> TYPE <- "final"
> ## use "rolling" for true one-step-ahead predictions => TAKES ~8 HOURS!
> 
> val_A0 <- oneStepAhead(res_A0, tp=tp, type=TYPE, verbose=verbose)
> val_B0 <- oneStepAhead(res_B0, tp=tp, type=TYPE, verbose=verbose)
> val_C0 <- oneStepAhead(res_C0, tp=tp, type=TYPE, verbose=verbose)
> 
> val_A1 <- oneStepAhead(res_A1, tp=tp, type=TYPE, verbose=verbose)
> val_B1 <- oneStepAhead(res_B1, tp=tp, type=TYPE, verbose=verbose)
> val_C1 <- oneStepAhead(res_C1, tp=tp, type=TYPE, verbose=verbose)
> 
> val_A2 <- oneStepAhead(res_A2, tp=tp, type=TYPE, verbose=verbose)
> val_B2 <- oneStepAhead(res_B2, tp=tp, type=TYPE, verbose=verbose)
> val_C2 <- oneStepAhead(res_C2, tp=tp, type=TYPE, verbose=verbose)
> 
> val_D <- oneStepAhead(res_D, tp=tp, type=TYPE, verbose=verbose)
> 
> 
> ## compute scores
> 
> vals <- ls(pattern="val_")
> nam <- substring(vals,first=5,last=6)
> 
> whichScores <- c("logs", "rps", "ses")
> scores_i <- vector(mode="list", length=length(vals))
> meanScores <- NULL
> for(i in seq_along(vals)){
+   sc <- scores(get(vals[i]), which=whichScores, individual=TRUE, reverse=TRUE)
+   ## reverse=TRUE => same permutation test results as in surveillance < 1.16.0
+   scores_i[[i]] <- sc
+   meanScores <- rbind(meanScores,colMeans(sc, dims=2))
+ }
> 
> names(scores_i) <- nam
> rownames(meanScores) <- nam
> 
> print(meanScores)
      logs     rps    ses
A0 0.57563 0.49044 7.0223
A1 0.56843 0.47122 5.8383
A2 0.55980 0.45005 5.2961
B0 0.54953 0.42695 4.8711
B1 0.54758 0.42388 4.8057
B2 0.54302 0.41660 4.7617
C0 0.54804 0.42433 4.8913
C1 0.54545 0.42021 4.8238
C2 0.54040 0.41230 4.7368
D  0.54284 0.41625 4.7628
> ## Note that the above use of "final" fitted values instead of "rolling"
> ## one-step-ahead predictions leads to different mean scores than reported
> ## in Paul & Held (2011, Table IV).
> 
> 
> ## assess statistical significance of score differences
> 
> compareWithBest <- function(best, whichModels, nPermut=9999, seed=1234){
+   set.seed(seed)
+   pVals <- NULL
+   for(score in seq_along(whichScores)){
+     p <- c()
+     for(model in whichModels){
+       p <- c(p, if(model==best) NA else
+           permutationTest(scores_i[[model]][,,score],scores_i[[best]][,,score],
+                           plot=interactive(),nPermutation=nPermut, verbose=TRUE)$pVal.permut)
+     }
+     pVals <- cbind(pVals,p)
+   }
+   return(pVals)
+ }
> 
> pVals_flu <- compareWithBest(best=9, whichModels=1:10,
+                              nPermut=999, # reduced for this demo
+                              seed=2059710987)
mean difference = 0.035229 	p(permutation) = 0.001 	p(paired t-test) = 1.7757e-43 
mean difference = 0.028031 	p(permutation) = 0.001 	p(paired t-test) = 1.3821e-32 
mean difference = 0.0194 	p(permutation) = 0.001 	p(paired t-test) = 3.2473e-18 
mean difference = 0.0091362 	p(permutation) = 0.001 	p(paired t-test) = 4.8525e-14 
mean difference = 0.0071813 	p(permutation) = 0.001 	p(paired t-test) = 2.2371e-18 
mean difference = 0.0026264 	p(permutation) = 0.001 	p(paired t-test) = 3.3382e-13 
mean difference = 0.0076384 	p(permutation) = 0.001 	p(paired t-test) = 1.7629e-10 
mean difference = 0.0050483 	p(permutation) = 0.001 	p(paired t-test) = 9.0441e-11 
mean difference = 0.0024468 	p(permutation) = 0.001 	p(paired t-test) = 1.9085e-09 
mean difference = 0.078141 	p(permutation) = 0.001 	p(paired t-test) = 1.0015e-46 
mean difference = 0.058918 	p(permutation) = 0.001 	p(paired t-test) = 1.1426e-33 
mean difference = 0.03775 	p(permutation) = 0.001 	p(paired t-test) = 6.5422e-20 
mean difference = 0.014649 	p(permutation) = 0.001 	p(paired t-test) = 1.5254e-16 
mean difference = 0.011581 	p(permutation) = 0.001 	p(paired t-test) = 2.4983e-13 
mean difference = 0.0043013 	p(permutation) = 0.001 	p(paired t-test) = 5.9325e-05 
mean difference = 0.012037 	p(permutation) = 0.001 	p(paired t-test) = 9.1832e-15 
mean difference = 0.0079092 	p(permutation) = 0.001 	p(paired t-test) = 4.8551e-11 
mean difference = 0.0039526 	p(permutation) = 0.001 	p(paired t-test) = 0.00029413 
mean difference = 2.2854 	p(permutation) = 0.001 	p(paired t-test) = 3.3242e-07 
mean difference = 1.1015 	p(permutation) = 0.001 	p(paired t-test) = 0.00042459 
mean difference = 0.55931 	p(permutation) = 0.015 	p(paired t-test) = 0.014 
mean difference = 0.13427 	p(permutation) = 0.116 	p(paired t-test) = 0.11846 
mean difference = 0.068876 	p(permutation) = 0.401 	p(paired t-test) = 0.4065 
mean difference = 0.024921 	p(permutation) = 0.792 	p(paired t-test) = 0.79163 
mean difference = 0.15451 	p(permutation) = 0.047 	p(paired t-test) = 0.053968 
mean difference = 0.086971 	p(permutation) = 0.162 	p(paired t-test) = 0.14575 
mean difference = 0.026012 	p(permutation) = 0.801 	p(paired t-test) = 0.78798 
> rownames(pVals_flu) <- nam
> colnames(pVals_flu) <- whichScores
> 
> print(pVals_flu)
    logs   rps   ses
A0 0.001 0.001 0.001
A1 0.001 0.001 0.001
A2 0.001 0.001 0.015
B0 0.001 0.001 0.116
B1 0.001 0.001 0.401
B2 0.001 0.001 0.792
C0 0.001 0.001 0.047
C1 0.001 0.001 0.162
C2    NA    NA    NA
D  0.001 0.001 0.801
> 
